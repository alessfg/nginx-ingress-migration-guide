<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Interactive migration guide for transitioning from Kubernetes community NGINX Ingress Controller to the Official NGINX Ingress Controller. Includes YAML analyzer, annotation mappings, and CRD examples.">
    <meta name="keywords" content="NGINX, Ingress, Kubernetes, Migration, Controller, CRD, VirtualServer, Policy">
    <meta name="author" content="F5, Inc.">
    <title>NGINX Ingress Migration Guide</title>
    <style>
        :root {
            --primary-color: #009639;
            --primary-dark: #006b2b;
            --secondary-color: #0066b3;
            --plus-color: #f57c00;
            --oss-color: #009639;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #e0e0e0;
            --code-bg: #f4f4f4;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: var(--text-color); background-color: var(--bg-color); }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 20px; }
        header { background: linear-gradient(135deg, var(--primary-color), var(--primary-dark)); color: white; padding: 40px 0; margin-bottom: 30px; }
        header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        header p { font-size: 1.1rem; opacity: 0.9; }
        .header-layout { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        .header-actions { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
        nav { background: var(--card-bg); padding: 15px 0; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        nav ul { list-style: none; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        nav a { color: var(--primary-color); text-decoration: none; padding: 8px 16px; border-radius: 20px; font-size: 0.9rem; transition: all 0.3s; }
        nav a:hover { background: var(--primary-color); color: white; }
        nav a.active { background: var(--primary-color); color: white; }
        main { padding: 20px 0 60px; }
        section { background: var(--card-bg); border-radius: 12px; padding: 30px; margin-bottom: 30px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h2 { color: var(--primary-color); border-bottom: 3px solid var(--primary-color); padding-bottom: 10px; margin-bottom: 25px; font-size: 1.8rem; }
        h3 { color: var(--secondary-color); margin: 30px 0 15px; font-size: 1.3rem; }
        .table-wrapper { overflow-x: auto; margin: 20px 0; }
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        .mapping-table th, .mapping-table td { width: 50%; white-space: nowrap; }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid var(--border-color); }
        th { background: var(--primary-color); color: white; font-weight: 600; }
        tr.expandable { cursor: pointer; transition: background-color 0.2s; }
        tr.expandable:hover { background-color: #e8f5e9; }
        tr.expandable:focus { outline: 2px solid var(--primary-color); outline-offset: -2px; background-color: #e8f5e9; }
        tr.expandable:focus-visible { outline: 2px solid var(--primary-color); outline-offset: -2px; }
        tr.expandable td:first-child { position: relative; padding-left: 24px; }
        tr.expandable td:first-child::before { content: '▶'; position: absolute; left: 8px; top: 14px; font-size: 0.7rem; transition: transform 0.2s; color: var(--primary-color); }
        tr.expandable.expanded td:first-child::before { transform: rotate(90deg); }
        tr.example-row { display: none; }
        tr.example-row.visible { display: table-row; }
        tr.example-row td { padding: 0; background: #fafafa; }
        .example-content { padding: 20px; border-left: 4px solid var(--primary-color); margin: 10px; background: white; border-radius: 0 8px 8px 0; }
        tr:not(.expandable):not(.example-row):hover { background-color: #f5f5f5; }
        .annotation-list { display: flex; flex-direction: column; gap: 4px; }
        code { background: var(--code-bg); padding: 2px 6px; border-radius: 4px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85em; color: #d63384; }
        pre { background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 8px; overflow-x: auto; font-size: 0.85rem; line-height: 1.5; margin: 15px 0; }
        pre code { background: none; color: inherit; padding: 0; }
        .comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 900px) { .comparison { grid-template-columns: 1fr; } }
        .comparison-block { border-radius: 8px; overflow: hidden; }
        .comparison-block h5 { padding: 10px 15px; margin: 0; font-size: 0.9rem; }
        .comparison-block.old h5 { background: #ffebee; color: #c62828; }
        .comparison-block.new h5 { background: #e8f5e9; color: #2e7d32; }
        .comparison-block pre { margin: 0; border-radius: 0 0 8px 8px; }
        .badge { font-size: 0.7rem; padding: 3px 8px; border-radius: 10px; font-weight: 500; margin-left: 5px; white-space: nowrap; }
        .badge-virtualserver { background: #e3f2fd; color: #1565c0; }
        .badge-virtualserverroute { background: #e8eaf6; color: #283593; }
        .badge-policy { background: #f3e5f5; color: #7b1fa2; }
        .badge-transportserver { background: #fff3e0; color: #bf4000; }
        .badge-globalconfiguration { background: #efebe9; color: #4e342e; }
        .badge-plus { background: #fff3e0; color: #bf360c; }
        .badge-annotation { background: #e0f2f1; color: #00695c; }
        .badge-configmap { background: #fff9c4; color: #8c6d00; }
        .badge-oss { background: #e8f5e9; color: #2e7d32; }
        .install-box { background: linear-gradient(135deg, #1a237e, #283593); color: white; padding: 15px 20px; border-radius: 8px; margin: 20px 0 15px; }
        .install-box h6 { margin: 0 0 10px; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; }
        .install-box h6::before { content: '⚙️'; }
        .install-box pre { background: rgba(0,0,0,0.3); margin: 0; padding: 12px 15px; font-size: 0.8rem; border-radius: 8px; }
        .install-box code { color: #90caf9; background: none; }
        .info-box { padding: 12px 16px; border-radius: 6px; margin: 15px 0; font-size: 0.9rem; }
        .info-box.note { background: #e3f2fd; border-left: 4px solid #2196f3; }
        .info-box.tip { background: #e8f5e9; border-left: 4px solid #4caf50; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: center; }
        .controls input[type="text"] { padding: 10px 16px; border: 2px solid var(--border-color); border-radius: 6px; font-size: 0.9rem; outline: none; transition: border-color 0.2s, box-shadow 0.2s; min-width: 240px; flex: 1; max-width: 400px; }
        .controls input[type="text"]:focus { border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0,150,57,0.12); }
        .controls input[type="text"]::placeholder { color: #999; }
        .search-count { font-size: 0.82rem; color: #666; white-space: nowrap; }
        .search-count.no-results { color: #c62828; }
        .btn { padding: 10px 20px; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; }
        .btn-primary { background: var(--primary-color); color: white; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-secondary { background: #e0e0e0; color: var(--text-color); }
        .btn-secondary:hover { background: #d0d0d0; }
        .edition-header { display: flex; align-items: center; gap: 15px; margin: 40px 0 20px; padding: 15px 20px; border-radius: 8px; }
        .edition-header.oss { background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border-left: 5px solid var(--oss-color); }
        .edition-header.plus { background: linear-gradient(135deg, #fff3e0, #ffe0b2); border-left: 5px solid var(--plus-color); }
        .edition-header h3 { margin: 0; font-size: 1.4rem; }
        .edition-header.oss h3 { color: var(--oss-color); }
        .edition-header.plus h3 { color: var(--plus-color); }
        .edition-header p { margin: 5px 0 0; font-size: 0.9rem; color: #666; }
        .feature-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 25px; margin: 20px 0; }
        .feature-card { background: #f8f9fa; border-radius: 12px; padding: 25px; border: 1px solid var(--border-color); }
        .feature-card h4 { color: var(--primary-color); margin: 0 0 15px; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .feature-card .description { font-size: 0.95rem; color: #555; margin-bottom: 15px; line-height: 1.5; }
        .feature-card ul { margin: 0; padding-left: 20px; }
        .feature-card li { margin: 8px 0; font-size: 0.9rem; }
        .feature-card li strong { color: var(--secondary-color); }
        .legend { display: flex; flex-wrap: wrap; gap: 15px; margin: 15px 0; padding: 15px; background: #f8f9fa; border-radius: 8px; }
        .legend-item { display: flex; align-items: center; gap: 5px; font-size: 0.85rem; }
        .crd-indicator { color: var(--primary-color); font-weight: 500; }
        .checklist { list-style: none; padding: 0; }
        .checklist li { padding: 10px 0 10px 35px; position: relative; border-bottom: 1px solid var(--border-color); }
        .checklist li::before { content: '☐'; position: absolute; left: 0; font-size: 1.2rem; color: var(--primary-color); }
        footer { background: var(--text-color); color: white; padding: 30px 0; text-align: center; }
        footer a { color: #90EE90; }
        .copy-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.75rem; cursor: pointer; float: right; }
        .copy-btn:hover { background: rgba(255,255,255,0.3); }
        .copy-btn.copied { background: #4caf50; }
        .approach-tabs { display: flex; gap: 0; margin-bottom: 15px; border-bottom: 2px solid var(--border-color); }
        .approach-tab { padding: 8px 20px; border: none; background: none; cursor: pointer; font-size: 0.9rem; font-weight: 500; color: #666; border-bottom: 2px solid transparent; margin-bottom: -2px; transition: all 0.2s; }
        .approach-tab:hover { color: var(--primary-color); }
        .approach-tab.active { color: var(--primary-color); border-bottom-color: var(--primary-color); }
        .approach-content { display: none; }
        .approach-content.active { display: block; }
        h2[id], h3[id] { display: flex; align-items: center; }
        .heading-anchor { display: inline-flex; align-items: center; margin-left: 8px; opacity: 0; transition: opacity 0.2s; text-decoration: none; color: inherit; }
        h2:hover .heading-anchor, h3:hover .heading-anchor, .heading-anchor:focus { opacity: 0.5; }
        .heading-anchor:hover { opacity: 1 !important; }
        #yamlInput { width: 100%; min-height: 300px; background: #1e1e1e; color: #d4d4d4; border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85rem; line-height: 1.5; resize: vertical; tab-size: 2; }
        #yamlInput::placeholder { color: #666; }
        #yamlInput:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 3px rgba(0,150,57,0.15); }
        .analyzer-actions { display: flex; gap: 10px; margin-top: 10px; flex-wrap: wrap; }
        .analyzer-summary { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .analyzer-pill { padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; transition: transform 0.15s, box-shadow 0.15s; }
        .analyzer-pill[data-scroll] { cursor: pointer; }
        .analyzer-pill[data-scroll]:hover { transform: translateY(-1px); box-shadow: 0 2px 8px rgba(0,0,0,0.12); }
        .analyzer-pill.found { background: #e8f5e9; color: #2e7d32; }
        .analyzer-pill.paths { background: #e3f2fd; color: #1565c0; }
        .analyzer-pill.crds { background: #fff3e0; color: #bf4000; }
        .analyzer-pill.unrecognized { background: #ffebee; color: #c62828; }
        .analyzer-card { background: var(--card-bg); border-radius: 8px; padding: 16px 20px; margin-bottom: 12px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); border-left: 4px solid var(--primary-color); }
        .analyzer-card.type-annotation { border-left-color: #00897b; }
        .analyzer-card.type-configmap { border-left-color: #f9a825; }
        .analyzer-card.type-virtualserver { border-left-color: #1565c0; }
        .analyzer-card.type-virtualserverroute { border-left-color: #283593; }
        .analyzer-card.type-policy { border-left-color: #7b1fa2; }
        .analyzer-card.type-transportserver { border-left-color: #ef6c00; }
        .analyzer-card.type-globalconfiguration { border-left-color: #4e342e; }
        .analyzer-card.unrecognized { border-left-color: #c62828; }
        .analyzer-card-header { display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; flex-wrap: wrap; }
        .analyzer-card-header .found-annotations { flex: 1; }
        .analyzer-card-header .found-annotations code { display: inline-block; margin: 2px 4px 2px 0; }
        .analyzer-card-body { margin-top: 10px; padding-top: 10px; border-top: 1px solid var(--border-color); font-size: 0.9rem; }
        .analyzer-card-body .migration-arrow { color: var(--primary-color); font-weight: 600; margin-right: 6px; }
        .analyzer-card-footer { margin-top: 10px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px; }
        .analyzer-card-footer .category-label { font-size: 0.8rem; color: #888; }
        .analyzer-card-footer a { font-size: 0.85rem; color: var(--primary-color); text-decoration: none; font-weight: 500; }
        .analyzer-card-footer a:hover { text-decoration: underline; }
        .analyzer-card .annotation-value { color: #888; font-size: 0.82rem; margin-left: 4px; }
        .analyzer-error { padding: 12px 16px; border-radius: 6px; margin-top: 15px; font-size: 0.9rem; background: #ffebee; border-left: 4px solid #c62828; color: #c62828; }
        .analyzer-info { padding: 12px 16px; border-radius: 6px; margin-top: 15px; font-size: 0.9rem; background: #e3f2fd; border-left: 4px solid #2196f3; color: #1565c0; }
        #analyzerResults { margin-top: 20px; }
        .analyzer-unrecognized-section { margin-top: 20px; }
        .analyzer-unrecognized-section h4 { color: #c62828; margin-bottom: 10px; font-size: 1rem; }
        .plus-indicator { font-size: 0.75rem; padding: 2px 6px; background: #fff3e0; color: #e65100; border-radius: 8px; font-weight: 500; margin-left: 6px; }
        .analyzer-step { margin-top: 25px; padding-left: 20px; border-left: 2px solid var(--border-color); margin-left: 15px; position: relative; }
        .analyzer-step:last-of-type { border-left-color: transparent; }
        .analyzer-step-header { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; position: relative; }
        .analyzer-step-number { width: 32px; height: 32px; border-radius: 50%; background: var(--primary-color); color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 0.95rem; flex-shrink: 0; position: relative; left: -37px; margin-right: -25px; z-index: 1; box-shadow: 0 0 0 4px var(--card-bg); }
        .analyzer-step-title { font-size: 1.1rem; font-weight: 700; color: var(--text-color); }
        .analyzer-step-desc { font-size: 0.9rem; color: #666; margin-bottom: 12px; }
        .analyzer-yaml-output { position: relative; background: #1e1e1e; color: #d4d4d4; padding: 20px; border-radius: 8px; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.85rem; line-height: 1.5; overflow-x: auto; white-space: pre; margin: 10px 0; }
        .analyzer-copy-btn { position: absolute; top: 8px; right: 8px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.25); color: #ccc; padding: 5px 12px; border-radius: 4px; font-size: 0.75rem; cursor: pointer; transition: all 0.2s; z-index: 1; }
        .analyzer-copy-btn:hover { background: rgba(255,255,255,0.25); color: white; }
        .analyzer-copy-btn.copied { background: #4caf50; color: white; border-color: #4caf50; }
        .analyzer-install-cmd { background: linear-gradient(135deg, #1a237e, #283593); color: white; padding: 12px 16px; border-radius: 8px; margin: 10px 0; font-family: 'Monaco', 'Menlo', monospace; font-size: 0.82rem; line-height: 1.5; overflow-x: auto; position: relative; }
        .analyzer-install-cmd .analyzer-copy-btn { top: 6px; right: 6px; }
        .analyzer-details-toggle { background: none; border: none; color: var(--primary-color); font-size: 0.85rem; cursor: pointer; padding: 6px 0; font-weight: 500; display: flex; align-items: center; gap: 4px; margin-top: 8px; }
        .analyzer-details-toggle:hover { text-decoration: underline; }
        .analyzer-details-toggle::before { content: '▶'; font-size: 0.65rem; transition: transform 0.2s; display: inline-block; }
        .analyzer-details-toggle.expanded::before { transform: rotate(90deg); }
        .analyzer-details-container { margin-top: 8px; max-height: 0; overflow: hidden; opacity: 0; transition: max-height 0.35s ease, opacity 0.25s ease; }
        .analyzer-details-container.visible { max-height: 5000px; opacity: 1; }
        .analyzer-step-separator { border: none; border-top: 1px dashed var(--border-color); margin: 15px 0 0; }
        .analyzer-crd-group { margin-top: 15px; padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid var(--border-color); }
        .analyzer-crd-group-title { font-size: 0.95rem; font-weight: 600; color: var(--secondary-color); margin-bottom: 8px; }
        .analyzer-dual-note { font-size: 0.82rem; color: #888; font-style: italic; margin-top: 4px; }
        .yaml-key { color: #9cdcfe; }
        .yaml-value { color: #ce9178; }
        .yaml-comment { color: #6a9955; font-style: italic; }
        .yaml-keyword { color: #569cd6; }
        .yaml-bool { color: #569cd6; }
        .yaml-number { color: #b5cea8; }
        .yaml-separator { color: #808080; }
        .yaml-anchor { color: #dcdcaa; }
        .analyzer-step-icon { font-size: 1.1rem; margin-right: 2px; }
        .analyzer-comparison { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 10px 0; }
        @media (max-width: 900px) { .analyzer-comparison { grid-template-columns: 1fr; } }
        .analyzer-comparison-block { border-radius: 8px; overflow: hidden; }
        .analyzer-comparison-block h5 { padding: 8px 12px; margin: 0; font-size: 0.82rem; font-weight: 600; }
        .analyzer-comparison-block.old h5 { background: #ffebee; color: #c62828; }
        .analyzer-comparison-block.new h5 { background: #e8f5e9; color: #2e7d32; }
        .analyzer-comparison-block .analyzer-yaml-output { margin: 0; border-radius: 0 0 8px 8px; min-height: 60px; }
        .analyzer-copy-all { display: flex; align-items: center; gap: 8px; margin-top: 20px; padding: 12px 20px; background: var(--primary-color); color: white; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        .analyzer-copy-all:hover { background: var(--primary-dark); }
        .analyzer-copy-all.copied { background: #4caf50; }
        .analyzer-copy-all svg { flex-shrink: 0; }
        .analyzer-step-count { font-size: 0.78rem; font-weight: 600; padding: 2px 10px; border-radius: 12px; background: #e8f5e9; color: #2e7d32; margin-left: 8px; }
        .analyzer-step-count.configmap { background: #fff9c4; color: #f57f17; }
        .analyzer-step-count.crd { background: #f3e5f5; color: #7b1fa2; }
        .yaml-diff-line { display: inline-block; width: calc(100% + 40px); margin: 0 -20px; padding: 0 20px; }
        .yaml-diff-line.removed { background: rgba(198, 40, 40, 0.12); }
        .yaml-diff-line.added { background: rgba(46, 125, 50, 0.12); }
        @media (max-width: 600px) {
            .analyzer-actions { flex-direction: column; }
            .analyzer-actions .btn { width: 100%; text-align: center; }
            .controls input[type="text"] { min-width: 100%; max-width: 100%; }
            .analyzer-step-header { flex-wrap: wrap; }
            .analyzer-step-count { margin-left: 44px; margin-top: -4px; }
            .analyzer-copy-all { width: 100%; justify-content: center; }
            .analyzer-download-btn { width: 100%; justify-content: center; }
            .analyzer-export-actions { flex-direction: column; }
            .mapping-table th, .mapping-table td { white-space: normal; word-break: break-word; font-size: 0.82rem; padding: 10px 8px; }
            .mapping-table code { font-size: 0.75rem; word-break: break-all; }
            header h1 { font-size: 1.8rem; }
            header p { font-size: 0.95rem; }
            nav ul { gap: 5px; }
            nav a { padding: 6px 10px; font-size: 0.8rem; }
            .sample-dropdown-menu { min-width: 260px; left: auto; right: 0; }
        }
        .analyzer-empty-state { text-align: center; padding: 40px 20px; color: #999; }
        .analyzer-empty-state svg { margin-bottom: 12px; opacity: 0.4; }
        .analyzer-empty-state p { font-size: 0.9rem; margin: 4px 0; }
        .analyzer-empty-state .hint { font-size: 0.82rem; color: #bbb; }
        .analyzer-success-banner { display: flex; align-items: center; gap: 10px; padding: 14px 18px; background: linear-gradient(135deg, #e8f5e9, #c8e6c9); border-radius: 8px; margin-bottom: 16px; border: 1px solid #a5d6a7; }
        .analyzer-success-banner svg { flex-shrink: 0; color: #2e7d32; }
        .analyzer-success-banner .banner-text { font-size: 0.9rem; color: #1b5e20; font-weight: 500; }
        .analyzer-success-banner .banner-text strong { font-weight: 700; }
        .analyzer-next-steps { margin-top: 24px; padding: 20px; background: #f8f9fa; border-radius: 8px; border: 1px solid var(--border-color); }
        .analyzer-next-steps h4 { color: var(--primary-color); margin: 0 0 12px; font-size: 1rem; display: flex; align-items: center; gap: 8px; }
        .analyzer-next-steps ul { list-style: none; padding: 0; margin: 0; }
        .analyzer-next-steps li { padding: 6px 0; font-size: 0.9rem; }
        .analyzer-next-steps li::before { content: '\2192'; color: var(--primary-color); margin-right: 8px; font-weight: 600; }
        .analyzer-next-steps a { color: var(--primary-color); text-decoration: none; font-weight: 500; }
        .analyzer-next-steps a:hover { text-decoration: underline; }
        .analyzer-complexity { display: inline-flex; align-items: center; gap: 6px; margin-left: 12px; padding: 3px 10px; border-radius: 12px; font-size: 0.78rem; font-weight: 600; }
        .analyzer-complexity.simple { background: #e8f5e9; color: #2e7d32; }
        .analyzer-complexity.moderate { background: #fff9c4; color: #f57f17; }
        .analyzer-complexity.advanced { background: #fce4ec; color: #c62828; }
        .analyzer-complexity-dots { display: flex; gap: 3px; }
        .analyzer-complexity-dots span { width: 8px; height: 8px; border-radius: 50%; background: currentColor; opacity: 0.25; }
        .analyzer-complexity-dots span.filled { opacity: 1; }
        .analyzer-yaml-output.collapsed { max-height: 200px; overflow: hidden; }
        .analyzer-yaml-output.collapsed::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 60px; background: linear-gradient(transparent, #1e1e1e); pointer-events: none; }
        .analyzer-yaml-expand { background: none; border: 1px solid var(--border-color); color: var(--primary-color); padding: 4px 14px; border-radius: 4px; font-size: 0.8rem; cursor: pointer; margin-top: 4px; font-weight: 500; transition: all 0.2s; }
        .analyzer-yaml-expand:hover { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .analyzer-edit-btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; background: var(--card-bg); border: 2px solid var(--primary-color); color: var(--primary-color); border-radius: 6px; font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-top: 16px; }
        .analyzer-edit-btn:hover { background: var(--primary-color); color: white; }
        @keyframes analyzerFadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
        .analyzer-fade-in { animation: analyzerFadeIn 0.4s ease forwards; opacity: 0; }
        .analyzer-input-status { display: flex; gap: 16px; margin-top: 6px; font-size: 0.78rem; color: #999; align-items: center; flex-wrap: wrap; }
        .analyzer-input-status .status-item { display: flex; align-items: center; gap: 4px; }
        .analyzer-input-status .status-dot { width: 6px; height: 6px; border-radius: 50%; }
        .analyzer-input-status .status-dot.active { background: var(--primary-color); }
        .analyzer-input-status .status-dot.inactive { background: #ccc; }
        .analyzer-drop-zone { position: relative; }
        .analyzer-drop-overlay { display: none; position: absolute; inset: 0; background: rgba(0, 150, 57, 0.08); border: 3px dashed var(--primary-color); border-radius: 8px; z-index: 10; align-items: center; justify-content: center; pointer-events: none; }
        .analyzer-drop-zone.dragging .analyzer-drop-overlay { display: flex; }
        .analyzer-drop-zone.dragging #yamlInput { opacity: 0.5; }
        .analyzer-drop-label { background: white; padding: 12px 24px; border-radius: 8px; font-size: 0.95rem; font-weight: 600; color: var(--primary-color); box-shadow: 0 2px 12px rgba(0,0,0,0.1); }
        .analyzer-export-actions { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; align-items: center; }
        .analyzer-download-btn { display: inline-flex; align-items: center; gap: 8px; padding: 12px 20px; background: var(--secondary-color); color: white; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: background 0.2s; }
        .analyzer-download-btn:hover { background: #005299; }
        .analyzer-download-btn.downloaded { background: #4caf50; }
        .analyzer-download-btn svg { flex-shrink: 0; }
        body.dark-mode { --bg-color: #1a1a2e; --card-bg: #16213e; --text-color: #e0e0e0; --border-color: #2a2a4a; --code-bg: #0f3460; }
        body.dark-mode header { background: linear-gradient(135deg, #006b2b, #004d1f); }
        body.dark-mode nav { background: #16213e; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }
        body.dark-mode nav a { color: #66bb6a; }
        body.dark-mode nav a:hover, body.dark-mode nav a.active { background: #66bb6a; color: #1a1a2e; }
        body.dark-mode section { background: var(--card-bg); box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
        body.dark-mode h2 { color: #66bb6a; border-bottom-color: #66bb6a; }
        body.dark-mode h3 { color: #64b5f6; }
        body.dark-mode th { background: #006b2b; }
        body.dark-mode tr.expandable:hover { background-color: rgba(102,187,106,0.1); }
        body.dark-mode tr.expandable:focus { outline-color: #66bb6a; background-color: rgba(102,187,106,0.1); }
        body.dark-mode tr:not(.expandable):not(.example-row):hover { background-color: rgba(255,255,255,0.03); }
        body.dark-mode tr.example-row td { background: #0f3460; }
        body.dark-mode .example-content { background: #16213e; border-left-color: #66bb6a; }
        body.dark-mode code { background: rgba(15,52,96,0.5); color: #f48fb1; }
        body.dark-mode .info-box.note { background: rgba(33,150,243,0.1); }
        body.dark-mode .info-box.tip { background: rgba(76,175,80,0.1); }
        body.dark-mode .controls input[type="text"] { background: #0f3460; color: #e0e0e0; border-color: #2a2a4a; }
        body.dark-mode .controls input[type="text"]::placeholder { color: #666; }
        body.dark-mode .controls input[type="text"]:focus { border-color: #66bb6a; box-shadow: 0 0 0 3px rgba(102,187,106,0.15); }
        body.dark-mode .legend { background: #0f3460; }
        body.dark-mode .edition-header.oss { background: linear-gradient(135deg, rgba(102,187,106,0.1), rgba(102,187,106,0.05)); }
        body.dark-mode .edition-header.plus { background: linear-gradient(135deg, rgba(245,124,0,0.15), rgba(245,124,0,0.05)); }
        body.dark-mode .comparison-block.old h5 { background: rgba(198,40,40,0.15); color: #ef9a9a; }
        body.dark-mode .comparison-block.new h5 { background: rgba(46,125,50,0.15); color: #a5d6a7; }
        body.dark-mode .feature-card { background: #0f3460; border-color: #2a2a4a; }
        body.dark-mode .feature-card .description { color: #aaa; }
        body.dark-mode footer { background: #0d1b2a; }
        body.dark-mode .btn-secondary { background: #2a2a4a; color: #e0e0e0; }
        body.dark-mode .btn-secondary:hover { background: #3a3a5a; }
        body.dark-mode .analyzer-success-banner { background: linear-gradient(135deg, rgba(46,125,50,0.15), rgba(46,125,50,0.08)); border-color: rgba(46,125,50,0.3); }
        body.dark-mode .analyzer-success-banner .banner-text { color: #a5d6a7; }
        body.dark-mode .analyzer-next-steps { background: #0f3460; border-color: #2a2a4a; }
        body.dark-mode .analyzer-next-steps h4 { color: #66bb6a; }
        body.dark-mode .analyzer-crd-group { background: #0f3460; border-color: #2a2a4a; }
        body.dark-mode .analyzer-card { background: #0f3460; box-shadow: 0 1px 4px rgba(0,0,0,0.2); }
        body.dark-mode .analyzer-card-body { border-top-color: #2a2a4a; }
        body.dark-mode .analyzer-card-footer .category-label { color: #888; }
        body.dark-mode .analyzer-comparison-block.old h5 { background: rgba(198,40,40,0.15); color: #ef9a9a; }
        body.dark-mode .analyzer-comparison-block.new h5 { background: rgba(46,125,50,0.15); color: #a5d6a7; }
        body.dark-mode .analyzer-edit-btn { background: #16213e; border-color: #66bb6a; color: #66bb6a; }
        body.dark-mode .analyzer-edit-btn:hover { background: #66bb6a; color: #1a1a2e; }
        body.dark-mode .analyzer-yaml-expand { border-color: #2a2a4a; color: #66bb6a; }
        body.dark-mode .analyzer-yaml-expand:hover { background: #66bb6a; color: #1a1a2e; border-color: #66bb6a; }
        body.dark-mode .analyzer-step { border-left-color: #2a2a4a; }
        body.dark-mode .analyzer-step-number { box-shadow: 0 0 0 4px var(--card-bg); }
        body.dark-mode .analyzer-empty-state svg { stroke: #666; }
        body.dark-mode .analyzer-step-separator { border-top-color: #2a2a4a; }
        body.dark-mode .checklist li { border-bottom-color: #2a2a4a; }
        body.dark-mode td, body.dark-mode th { border-bottom-color: #2a2a4a; }
        .nav-badge { display: inline-flex; align-items: center; justify-content: center; min-width: 18px; height: 18px; padding: 0 5px; border-radius: 9px; background: var(--primary-color); color: white; font-size: 0.7rem; font-weight: 700; margin-left: 5px; line-height: 1; }
        body.dark-mode .nav-badge { background: #66bb6a; color: #1a1a2e; }
        .dark-toggle { display: inline-flex; align-items: center; gap: 6px; background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 14px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; transition: background 0.2s; }
        .dark-toggle:hover { background: rgba(255,255,255,0.25); }
        .annotation-tooltip { position: relative; cursor: help; }
        .annotation-tooltip::after { content: attr(data-tip); position: absolute; bottom: calc(100% + 6px); left: 50%; transform: translateX(-50%); background: #333; color: #fff; padding: 6px 10px; border-radius: 6px; font-size: 0.78rem; white-space: nowrap; max-width: 320px; white-space: normal; line-height: 1.4; pointer-events: none; opacity: 0; transition: opacity 0.15s; z-index: 20; box-shadow: 0 2px 8px rgba(0,0,0,0.2); font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .annotation-tooltip::before { content: ''; position: absolute; bottom: calc(100% + 2px); left: 50%; transform: translateX(-50%); border: 5px solid transparent; border-top-color: #333; pointer-events: none; opacity: 0; transition: opacity 0.15s; z-index: 20; }
        .annotation-tooltip:hover::after, .annotation-tooltip:hover::before, .annotation-tooltip:focus::after, .annotation-tooltip:focus::before { opacity: 1; }
        .sample-dropdown { position: relative; display: inline-block; }
        .sample-dropdown-btn { display: inline-flex; align-items: center; gap: 6px; }
        .sample-dropdown-btn::after { content: '\25BC'; font-size: 0.6rem; opacity: 0.7; }
        .sample-dropdown-menu { display: none; position: absolute; bottom: calc(100% + 6px); left: 0; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); min-width: 280px; max-width: calc(100vw - 40px); z-index: 50; overflow: hidden; }
        .sample-dropdown-menu.visible { display: block; animation: analyzerFadeIn 0.15s ease; }
        .sample-dropdown-item { padding: 12px 16px; cursor: pointer; transition: background 0.15s; border-bottom: 1px solid var(--border-color); }
        .sample-dropdown-item:last-child { border-bottom: none; }
        .sample-dropdown-item:hover { background: #e8f5e9; }
        .sample-dropdown-item .sample-title { font-weight: 600; font-size: 0.88rem; color: var(--text-color); display: flex; align-items: center; gap: 6px; }
        .sample-dropdown-item .sample-desc { font-size: 0.78rem; color: #888; margin-top: 2px; }
        .sample-dropdown-item .sample-badge { font-size: 0.68rem; padding: 2px 7px; border-radius: 8px; font-weight: 600; }
        .sample-badge.simple { background: #e8f5e9; color: #2e7d32; }
        .sample-badge.moderate { background: #fff9c4; color: #f57f17; }
        .sample-badge.advanced { background: #fce4ec; color: #c62828; }
        body.dark-mode .sample-dropdown-menu { background: #16213e; border-color: #2a2a4a; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
        body.dark-mode .sample-dropdown-item:hover { background: rgba(102,187,106,0.1); }
        body.dark-mode .sample-dropdown-item { border-bottom-color: #2a2a4a; }
        .scroll-to-top { position: fixed; bottom: 30px; right: 30px; width: 44px; height: 44px; border-radius: 50%; background: var(--primary-color); color: white; border: none; cursor: pointer; display: none; align-items: center; justify-content: center; box-shadow: 0 3px 12px rgba(0,0,0,0.2); z-index: 200; transition: opacity 0.2s, transform 0.2s; }
        .scroll-to-top:hover { transform: scale(1.1); background: var(--primary-dark); }
        .scroll-to-top.visible { display: flex; }
        body.dark-mode .scroll-to-top { background: #66bb6a; color: #1a1a2e; }
        body.dark-mode .scroll-to-top:hover { background: #81c784; }
        .skip-link { position: absolute; top: -50px; left: 20px; padding: 10px 18px; background: var(--primary-color); color: white; text-decoration: none; border-radius: 0 0 8px 8px; z-index: 1000; transition: top 0.2s; font-weight: 600; }
        .skip-link:focus { top: 0; }
        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0; }
        @media print {
            nav, header, footer, .analyzer-actions, .analyzer-input-status, .analyzer-drop-zone, .analyzer-copy-btn, .analyzer-copy-all, .analyzer-download-btn, .analyzer-edit-btn, .analyzer-yaml-expand, .analyzer-empty-state, .controls, .legend, .analyzer-export-actions { display: none !important; }
            section { box-shadow: none; break-inside: avoid; }
            .analyzer-yaml-output { background: #f5f5f5 !important; color: #333 !important; border: 1px solid #ccc; }
            .analyzer-yaml-output.collapsed { max-height: none !important; overflow: visible !important; }
            .analyzer-yaml-output.collapsed::after { display: none !important; }
            tr.example-row { display: table-row !important; }
            tr.expandable td:first-child::before { content: '' !important; }
            .yaml-key { color: #0066b3 !important; }
            .yaml-value { color: #c62828 !important; }
            .yaml-comment { color: #666 !important; }
            .analyzer-install-cmd { background: #f0f0f0 !important; color: #333 !important; border: 1px solid #ccc; }
            .analyzer-success-banner { border: 1px solid #999; }
            body { background: white; font-size: 11pt; }
            .analyzer-details-container { max-height: none !important; opacity: 1 !important; }
        }
    </style>
</head>
<body>
    <a href="#analyzer" class="skip-link">Skip to main content</a>
    <header>
        <div class="container header-layout">
            <div>
                <h1>NGINX Ingress Migration Guide</h1>
                <p>Migrate from Kubernetes Community NGINX Ingress to Official NGINX Ingress Controller</p>
            </div>
            <div class="header-actions">
            <button class="dark-toggle" id="darkToggle" onclick="toggleDarkMode()" aria-label="Toggle dark mode">
                <svg id="darkIcon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                <span id="darkLabel">Dark Mode</span>
            </button>
            <a href="https://github.com/alessfg/nginx-ingress-migration-guide" target="_blank" rel="noopener noreferrer" aria-label="Contribute on GitHub (opens in new tab)" style="display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,0.15);color:white;text-decoration:none;padding:10px 18px;border-radius:8px;font-size:0.9rem;border:1px solid rgba(255,255,255,0.3);transition:background 0.2s;" onmouseover="this.style.background='rgba(255,255,255,0.25)'" onmouseout="this.style.background='rgba(255,255,255,0.15)'">
                <svg width="20" height="20" viewBox="0 0 16 16" fill="white"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.01 8.01 0 0016 8c0-4.42-3.58-8-8-8z"/></svg>
                Contribute on GitHub
            </a>
            </div>
        </div>
    </header>

    <nav role="navigation" aria-label="Main navigation">
        <div class="container">
            <ul role="menubar">
                <li role="none"><a role="menuitem" href="#analyzer">YAML Analyzer</a></li>
                <li role="none"><a role="menuitem" href="#differences">Key Differences</a></li>
                <li role="none"><a role="menuitem" href="#oss-mappings">OSS Mappings</a></li>
                <li role="none"><a role="menuitem" href="#plus-mappings">Plus Mappings</a></li>
                <li role="none"><a role="menuitem" href="#features">CRD Features</a></li>
                <li role="none"><a role="menuitem" href="#installation">Installation</a></li>
                <li role="none"><a role="menuitem" href="#checklist">Checklist</a></li>
            </ul>
        </div>
    </nav>

    <main class="container" role="main" aria-label="Migration guide content">
        <!-- YAML Migration Analyzer -->
        <section id="analyzer">
            <h2 id="yaml-analyzer">YAML Migration Analyzer</h2>
            <p>Paste a Kubernetes Ingress YAML manifest that uses community NGINX Ingress annotations to get migration suggestions for the Official NGINX Ingress Controller.</p>
            <div class="analyzer-drop-zone" id="dropZone">
                <div class="analyzer-drop-overlay"><span class="analyzer-drop-label">Drop YAML file here</span></div>
                <textarea id="yamlInput" aria-label="YAML input for migration analysis" placeholder="apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: my-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
    nginx.ingress.kubernetes.io/ssl-redirect: &quot;true&quot;
    nginx.ingress.kubernetes.io/proxy-body-size: &quot;10m&quot;
spec:
  ..."></textarea>
            </div>
            <div class="analyzer-input-status" id="inputStatus">
                <span class="status-item"><span class="status-dot inactive" id="statusDot"></span><span id="statusLines">0 lines</span></span>
                <span class="status-item" id="statusAnnotations" style="display:none;"><span class="status-dot active"></span><span id="statusAnnotationCount">0 annotations detected</span></span>
            </div>
            <div class="analyzer-actions">
                <button class="btn btn-primary" onclick="analyzeYaml()">Analyze YAML</button>
                <button class="btn btn-secondary" onclick="clearAnalyzer()">Clear</button>
                <div class="sample-dropdown">
                    <button class="btn btn-secondary sample-dropdown-btn" onclick="toggleSampleDropdown(event)" aria-expanded="false" aria-haspopup="true" aria-controls="sampleDropdown">Load Sample</button>
                    <div class="sample-dropdown-menu" id="sampleDropdown" role="menu" aria-label="Sample YAML presets">
                        <div class="sample-dropdown-item" role="menuitem" tabindex="0" onclick="loadSampleYaml('simple')" onkeydown="if(event.key==='Enter')loadSampleYaml('simple')">
                            <div class="sample-title"><span class="sample-badge simple">Simple</span> Basic Proxy</div>
                            <div class="sample-desc">SSL redirect, timeouts, body size — annotation-only migration</div>
                        </div>
                        <div class="sample-dropdown-item" role="menuitem" tabindex="0" onclick="loadSampleYaml('moderate')" onkeydown="if(event.key==='Enter')loadSampleYaml('moderate')">
                            <div class="sample-title"><span class="sample-badge moderate">Moderate</span> Production App</div>
                            <div class="sample-desc">Rewrites, rate limiting, CORS, access control — requires CRDs</div>
                        </div>
                        <div class="sample-dropdown-item" role="menuitem" tabindex="0" onclick="loadSampleYaml('advanced')" onkeydown="if(event.key==='Enter')loadSampleYaml('advanced')">
                            <div class="sample-title"><span class="sample-badge advanced">Advanced</span> Enterprise Stack</div>
                            <div class="sample-desc">mTLS, session affinity, WAF — requires NGINX Plus</div>
                        </div>
                    </div>
                </div>
                <span style="font-size:0.78rem;color:#999;margin-left:4px;align-self:center;">Ctrl+Enter to analyze</span>
            </div>
            <div id="analyzerResults" role="region" aria-label="Analysis results"><div id="analyzerLiveStatus" aria-live="polite" class="sr-only"></div></div>
        </section>

        <!-- Key Differences -->
        <section id="differences">
            <h2 id="key-differences">Key Differences</h2>
            <div class="table-wrapper">
                <table>
                    <thead><tr><th>Aspect</th><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr><td>Repository</td><td><code>kubernetes/ingress-nginx</code></td><td><code>nginx/kubernetes-ingress</code></td></tr>
                        <tr><td>Annotation Prefix</td><td><code>nginx.ingress.kubernetes.io/</code></td><td><code>nginx.org/</code> or <code>nginx.com/</code></td></tr>
                        <tr><td>CRD Support</td><td>Limited</td><td>VirtualServer, VirtualServerRoute, Policy, TransportServer</td></tr>
                        <tr><td>NGINX Plus Support</td><td>No</td><td>Yes (with <code>nginx.com/</code> annotations)</td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- OSS Mappings -->
        <section id="oss-mappings">
            <h2 id="oss-mappings-heading">NGINX Open Source Mappings</h2>
            <p>These features are available in both NGINX Open Source and NGINX Plus editions.</p>

            <div class="info-box tip" style="margin: 20px 0;">
                <strong>How to Read the Mappings</strong>
                <ul style="margin: 10px 0 0 20px;">
                    <li><strong>Annotation-to-annotation rows <span style="color: var(--primary-color);">▶</span>:</strong> Direct mappings where you change the annotation name/prefix. Click to expand and see before/after Ingress YAML examples.</li>
                    <li><strong>CRD-based rows <span style="color: var(--primary-color);">▶</span>:</strong> Annotations that map to a CRD (VirtualServer, Policy, or TransportServer). Click to expand for full CRD examples with installation instructions.</li>
                    <li><strong>Grouped annotations:</strong> Related annotations that work together are grouped in a single expandable row, showing how they map to a unified configuration.</li>
                    <li><strong>Official-only rows:</strong> Annotations marked <em>N/A</em> on the left are features unique to the Official controller with no community equivalent.</li>
                </ul>
            </div>

            <div class="controls">
                <input type="text" id="searchInput" placeholder="Search annotations..." onkeyup="filterTable('oss')" aria-label="Search annotations">
                <span id="searchCount" class="search-count" aria-live="polite"></span>
                <button class="btn btn-primary" onclick="expandAllExamples(this)">Expand All</button>
                <button class="btn btn-secondary" onclick="collapseAllExamples(this)">Collapse All</button>
            </div>

            <div class="legend">
                <div class="legend-item"><span class="legend-icon">▶</span> Click to expand</div>
                <div class="legend-item"><span class="badge badge-annotation">Annotation</span></div>
                <div class="legend-item"><span class="badge badge-configmap">ConfigMap</span></div>
                <div class="legend-item"><span class="badge badge-virtualserver">VirtualServer CRD</span></div>
                <div class="legend-item"><span class="badge badge-virtualserverroute">VirtualServerRoute CRD</span></div>
                <div class="legend-item"><span class="badge badge-policy">Policy CRD</span></div>
                <div class="legend-item"><span class="badge badge-transportserver">TransportServer CRD</span></div>
            </div>

            <!-- Access Control -->
            <h3 id="access-control">Access Control</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/denylist-source-range</code><code>nginx.ingress.kubernetes.io/whitelist-source-range</code></div></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <code>accessControl</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/whitelist-source-range: "10.0.0.0/8,172.16.0.0/12"
  nginx.ingress.kubernetes.io/denylist-source-range: "192.168.1.100"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: access-control
spec:
  accessControl:
    allow:
      - 10.0.0.0/8
      - 172.16.0.0/12
    deny:
      - 192.168.1.100</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/satisfy</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code>: <code>satisfy any;</code> or <code>satisfy all;</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/satisfy: "any"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    satisfy any;</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Authentication - Basic -->
            <h3 id="authentication-basic">Authentication (Basic)</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/auth-realm</code><code>nginx.ingress.kubernetes.io/auth-secret</code><code>nginx.ingress.kubernetes.io/auth-secret-type</code><code>nginx.ingress.kubernetes.io/auth-type: "basic"</code></div></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/basic-auth-*</code> or <span class="badge badge-policy">Policy CRD</span> <code>basicAuth</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="approach-tabs">
                                <button class="approach-tab active" onclick="switchApproach(this, 'annotation')">Annotation Approach</button>
                                <button class="approach-tab" onclick="switchApproach(this, 'crd')">CRD Approach</button>
                            </div>
                            <div class="approach-content active" data-approach="annotation">
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/auth-type: "basic"
  nginx.ingress.kubernetes.io/auth-secret: "basic-auth"
  nginx.ingress.kubernetes.io/auth-realm: "Protected Area"</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/basic-auth-secret: "basic-auth"
  nginx.org/basic-auth-realm: "Protected Area"</code></pre></div>
                                </div>
                                <div class="info-box note"><strong>Note:</strong> The secret must be of type <code>nginx.org/htpasswd</code>.</div>
                            </div>
                            <div class="approach-content" data-approach="crd">
                                <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                    <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                                </div>
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/auth-type: "basic"
  nginx.ingress.kubernetes.io/auth-secret: "basic-auth"
  nginx.ingress.kubernetes.io/auth-realm: "Protected Area"</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: v1
kind: Secret
metadata:
  name: basic-auth
type: nginx.org/htpasswd
data:
  htpasswd: dXNlcjokYXByMS4uLg==
---
apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: basic-auth-policy
spec:
  basicAuth:
    secret: basic-auth
    realm: "Protected Area"</code></pre></div>
                                </div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Buffering -->
            <h3 id="buffering">Buffering</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/client-body-buffer-size</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/client-body-buffer-size</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/client-body-buffer-size: "16k"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/client-body-buffer-size: "16k"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-body-size</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/client-max-body-size</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-body-size: "10m"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/client-max-body-size: "10m"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-buffer-size</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-buffer-size</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-buffer-size: "8k"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-buffer-size: "8k"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-buffering</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-buffering</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-buffering: "on"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-buffering: "on"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-buffers-number</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-buffers</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-buffers-number: "4"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-buffers: "4 8k"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Official annotation uses a combined format: <code>"number size"</code> (e.g., <code>"4 8k"</code>).</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-busy-buffers-size</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-busy-buffers-size</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-busy-buffers-size: "16k"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-busy-buffers-size: "16k"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-max-temp-file-size</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-max-temp-file-size</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-max-temp-file-size: "1024m"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-max-temp-file-size: "1024m"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-request-buffering</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-request-buffering: "off"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    proxy_request_buffering off;</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Official controller does not have a dedicated <code>proxy-request-buffering</code> annotation or ConfigMap key. Use <code>location-snippets</code> to set the <code>proxy_request_buffering</code> directive.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Canary / Traffic Splitting -->
            <h3 id="canary-traffic-splitting">Canary / Traffic Splitting</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/canary</code><code>nginx.ingress.kubernetes.io/canary-by-cookie</code><code>nginx.ingress.kubernetes.io/canary-by-header</code><code>nginx.ingress.kubernetes.io/canary-by-header-pattern</code><code>nginx.ingress.kubernetes.io/canary-by-header-value</code><code>nginx.ingress.kubernetes.io/canary-weight</code><code>nginx.ingress.kubernetes.io/canary-weight-total</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>splits[]</code> / <code>matches[]</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># Canary Ingress
annotations:
  nginx.ingress.kubernetes.io/canary: "true"
  nginx.ingress.kubernetes.io/canary-weight: "20"
  nginx.ingress.kubernetes.io/canary-by-header: "X-Canary"
  nginx.ingress.kubernetes.io/canary-by-cookie: "canary"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  upstreams:
    - name: main
      service: main-svc
      port: 80
    - name: canary
      service: canary-svc
      port: 80
  routes:
    - path: /
      matches:
        - conditions:
            - header: X-Canary
              value: "true"
          action:
            pass: canary
        - conditions:
            - cookie: canary
              value: "true"
          action:
            pass: canary
      splits:
        - weight: 80
          action: { pass: main }
        - weight: 20
          action: { pass: canary }</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Configuration Snippets -->
            <h3 id="configuration-snippets">Configuration Snippets</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/configuration-snippet</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/configuration-snippet: |
    more_set_headers "X-Custom: value";</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    add_header X-Custom "value";</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/server-snippet</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/server-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/server-snippet: |
    location /health { return 200; }</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/server-snippets: |
    location /health { return 200; }</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/stream-snippet</code></td>
                            <td><span class="badge badge-transportserver">TransportServer CRD</span> or GlobalConfiguration</td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/stream-snippet: |
    server { listen 3306; proxy_pass mysql; }</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Use TransportServer CRD instead
apiVersion: k8s.nginx.org/v1
kind: TransportServer
spec:
  listener:
    name: mysql-tcp
    protocol: TCP
  upstreams:
    - name: mysql
      service: mysql
      port: 3306
  action:
    pass: mysql</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- CORS -->
            <h3 id="cors">CORS</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/cors-allow-credentials</code><code>nginx.ingress.kubernetes.io/cors-allow-headers</code><code>nginx.ingress.kubernetes.io/cors-allow-methods</code><code>nginx.ingress.kubernetes.io/cors-allow-origin</code><code>nginx.ingress.kubernetes.io/cors-expose-headers</code><code>nginx.ingress.kubernetes.io/cors-max-age</code><code>nginx.ingress.kubernetes.io/enable-cors</code></div></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/server-snippets</code> or <code>nginx.org/location-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/enable-cors: "true"
  nginx.ingress.kubernetes.io/cors-allow-origin: "https://frontend.example.com"
  nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"
  nginx.ingress.kubernetes.io/cors-allow-headers: "Authorization, Content-Type"
  nginx.ingress.kubernetes.io/cors-allow-credentials: "true"
  nginx.ingress.kubernetes.io/cors-max-age: "86400"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
metadata:
  name: cors-app
spec:
  host: api.example.com
  server-snippets: |
    set $cors_origin "";
    if ($http_origin ~* "^https://frontend\.example\.com$") {
        set $cors_origin $http_origin;
    }
    add_header Access-Control-Allow-Origin $cors_origin always;
    add_header Access-Control-Allow-Credentials "true" always;
    add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
    add_header Access-Control-Allow-Headers "Authorization, Content-Type" always;
    add_header Access-Control-Max-Age 86400 always;
    if ($request_method = OPTIONS) {
        return 204;
    }
  upstreams:
    - name: api-backend
      service: api-service
      port: 80
  routes:
    - path: /
      action:
        pass: api-backend</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Official controller does not have dedicated CORS annotations. Use <code>server-snippets</code> or <code>location-snippets</code> to add CORS headers directly in the NGINX configuration.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Error Handling -->
            <h3 id="error-handling">Error Handling</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/custom-http-errors</code><code>nginx.ingress.kubernetes.io/default-backend</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>errorPages[]</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/custom-http-errors: "404,500,502"
  nginx.ingress.kubernetes.io/default-backend: "error-svc"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  routes:
    - path: /
      action:
        pass: backend
      errorPages:
        - codes: [404]
          redirect:
            url: /404.html
            code: 302
        - codes: [500, 502]
          return:
            code: 503
            body: "Service Unavailable"</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Headers -->
            <h3 id="headers">Headers</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/connection-proxy-header</code></td>
                            <td>Snippets or <span class="badge badge-configmap">ConfigMap</span></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/connection-proxy-header: "keep-alive"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    proxy_set_header Connection "keep-alive";</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/custom-headers</code></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>responseHeaders.add</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/custom-headers: "default/custom-headers-configmap"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  routes:
    - path: /
      action:
        proxy:
          upstream: my-backend
          responseHeaders:
            add:
              - name: X-Frame-Options
                value: "DENY"
              - name: X-Content-Type-Options
                value: "nosniff"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-hide-headers</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-hide-headers</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-hide-headers: "X-Powered-By,Server"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-hide-headers: "X-Powered-By,Server"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-pass-headers</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-pass-headers</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-pass-headers: "X-Custom-Header"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-pass-headers: "X-Custom-Header"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/upstream-vhost</code><code>nginx.ingress.kubernetes.io/x-forwarded-prefix</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>requestHeaders.set</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/upstream-vhost: "backend.internal"
  nginx.ingress.kubernetes.io/x-forwarded-prefix: "/api"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  routes:
    - path: /api
      action:
        proxy:
          upstream: my-backend
          requestHeaders:
            set:
              - name: Host
                value: "backend.internal"
              - name: X-Forwarded-Prefix
                value: "/api"</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- HSTS -->
            <h3 id="hsts">HSTS</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr><td><em>N/A (ConfigMap only)</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/hsts</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/hsts-max-age</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/hsts-include-subdomains</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/hsts-behind-proxy</code></td></tr>
                    </tbody>
                </table>
            </div>
            <div class="info-box note"><strong>Note:</strong> HSTS annotations are Official NGINX-only. The community controller handles HSTS via ConfigMap only.</div>

            <!-- Load Balancing -->
            <h3 id="load-balancing">Load Balancing</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/load-balance</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/lb-method</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/load-balance: "ewma"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/lb-method: "least_conn"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> Supported methods differ. Official supports: <code>round_robin</code>, <code>least_conn</code>, <code>ip_hash</code>, <code>hash</code>, <code>random</code>. The Official controller's default is <code>random two least_conn</code> (not <code>round_robin</code>), so load balancing behavior may change even without explicit configuration.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/service-upstream</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/use-cluster-ip</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/service-upstream: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/use-cluster-ip: "true"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/upstream-hash-by</code><code>nginx.ingress.kubernetes.io/upstream-hash-by-subset</code><code>nginx.ingress.kubernetes.io/upstream-hash-by-subset-size</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>upstreams[].lb-method</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/upstream-hash-by: "$request_uri"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  upstreams:
    - name: backend
      service: my-service
      port: 80
      lb-method: "hash $request_uri consistent"</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- mTLS (Client) -->
            <h3 id="mtls-client">mTLS (Client Certificate Verification)</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/auth-tls-error-page</code><code>nginx.ingress.kubernetes.io/auth-tls-pass-certificate-to-upstream</code><code>nginx.ingress.kubernetes.io/auth-tls-secret</code><code>nginx.ingress.kubernetes.io/auth-tls-verify-client</code><code>nginx.ingress.kubernetes.io/auth-tls-verify-depth</code></div></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <code>ingressMTLS</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/auth-tls-secret: "ns/ca-secret"
  nginx.ingress.kubernetes.io/auth-tls-verify-client: "on"
  nginx.ingress.kubernetes.io/auth-tls-verify-depth: "2"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: ingress-mtls
spec:
  ingressMTLS:
    clientCertSecret: ca-secret
    verifyClient: "on"
    verifyDepth: 2</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/auth-tls-match-cn</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/auth-tls-secret: "ns/ca-secret"
  nginx.ingress.kubernetes.io/auth-tls-verify-client: "on"
  nginx.ingress.kubernetes.io/auth-tls-match-cn: "CN=client-[0-9]+"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Use ingressMTLS Policy for basic mTLS, then add
# snippet for CN validation:
annotations:
  nginx.org/location-snippets: |
    if ($ssl_client_s_dn !~ "CN=client-[0-9]+") {
        return 403;
    }</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Official controller's <code>ingressMTLS</code> Policy does not have a built-in CN matching feature. Use <code>location-snippets</code> to add custom CN validation logic.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- mTLS (Backend) -->
            <h3 id="mtls-backend">mTLS (Backend/Egress)</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/proxy-ssl-ciphers</code><code>nginx.ingress.kubernetes.io/proxy-ssl-name</code><code>nginx.ingress.kubernetes.io/proxy-ssl-protocols</code><code>nginx.ingress.kubernetes.io/proxy-ssl-secret</code><code>nginx.ingress.kubernetes.io/proxy-ssl-server-name</code><code>nginx.ingress.kubernetes.io/proxy-ssl-verify</code><code>nginx.ingress.kubernetes.io/proxy-ssl-verify-depth</code></div></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <code>egressMTLS</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-ssl-secret: "ns/client-cert"
  nginx.ingress.kubernetes.io/proxy-ssl-verify: "on"
  nginx.ingress.kubernetes.io/proxy-ssl-verify-depth: "2"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: egress-mtls
spec:
  egressMTLS:
    tlsSecret: client-cert
    trustedCertSecret: ca-cert
    verifyServer: true
    verifyDepth: 2</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Miscellaneous -->
            <h3 id="miscellaneous">Miscellaneous</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/enable-access-log</code></td>
                            <td><span class="badge badge-configmap">ConfigMap</span> <code>access-log-off</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/enable-access-log: "false"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Set via ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
data:
  access-log-off: "true"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/enable-rewrite-log</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/enable-rewrite-log: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    rewrite_log on;</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Official controller does not have a dedicated <code>rewrite-log</code> ConfigMap key. Use <code>location-snippets</code> to enable the <code>rewrite_log</code> directive. Rewrite logging outputs to the error log at <code>notice</code> level.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/enable-opentelemetry</code></td>
                            <td><span class="badge badge-configmap">ConfigMap</span> <code>otel-*</code> keys</td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/enable-opentelemetry: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Set via ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx-config
data:
  otel-exporter-endpoint: "otel-collector:4317"
  otel-trace-in-http: "true"
  otel-service-name: "nginx-ingress"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Official controller uses <code>otel-exporter-endpoint</code>, <code>otel-trace-in-http</code>, <code>otel-service-name</code>, <code>otel-exporter-header-name</code>, and <code>otel-exporter-header-value</code> ConfigMap keys for OpenTelemetry. Set <code>otel-trace-in-http: "false"</code> to enable tracing for individual routes via snippets.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/http2-push-preload</code></td>
                            <td>Not supported</td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/http2-push-preload: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Not supported — HTTP/2 Server Push was deprecated
# by major browsers and removed from NGINX 1.25.1.
# No migration action needed.</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> HTTP/2 Server Push (<code>http2_push_preload</code>) was removed from NGINX in version 1.25.1 after major browsers deprecated the feature. This annotation can be safely removed during migration.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/mirror-target</code><code>nginx.ingress.kubernetes.io/mirror-request-body</code><code>nginx.ingress.kubernetes.io/mirror-host</code></div></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code> with <code>mirror</code> directive</td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/mirror-target: "https://mirror.example.com$request_uri"
  nginx.ingress.kubernetes.io/mirror-request-body: "on"
  nginx.ingress.kubernetes.io/mirror-host: "mirror.example.com"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    mirror /mirror;
    mirror_request_body on;
  nginx.org/server-snippets: |
    location /mirror {
      internal;
      proxy_set_header Host mirror.example.com;
      proxy_pass https://mirror.example.com$request_uri;
    }</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-http-version</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-http-version: "1.1"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    proxy_http_version 1.1;</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Official controller does not have a dedicated annotation for HTTP version. Use <code>location-snippets</code> to set <code>proxy_http_version</code> directly.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/server-alias</code></td>
                            <td>Create additional VirtualServer resources</td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/server-alias: "alias.example.com"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Create a separate VirtualServer per host
apiVersion: k8s.nginx.org/v1
kind: VirtualServer
metadata:
  name: alias-app
spec:
  host: alias.example.com
  routes:
    - path: /
      action:
        pass: main-backend</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><em>N/A (ConfigMap only)</em></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/server-tokens</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># ConfigMap setting only
apiVersion: v1
kind: ConfigMap
metadata:
  name: ingress-nginx-controller
data:
  server-tokens: "false"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/server-tokens: "false"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Community controller configures server tokens via ConfigMap only. The Official controller provides a per-Ingress annotation.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><em>N/A (automatic with HTTP/1.1)</em></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/websocket-services</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># WebSocket support is automatic
# Just ensure proxy-http-version: "1.1"
# and proper Upgrade/Connection headers</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/websocket-services: "ws-service"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Community controller handles WebSocket upgrades automatically. The Official controller provides an explicit annotation to enable WebSocket support for specific services.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)"><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/listen-ports</code> / <code>nginx.org/listen-ports-ssl</code></td></tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># No direct equivalent
# Port configuration is handled at the
# controller/service level</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/listen-ports: "8080,8443"
  nginx.org/listen-ports-ssl: "8443,9443"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> These annotations configure custom HTTP and HTTPS listen ports for the Ingress resource. Useful when the controller needs to listen on non-standard ports.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)"><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/mergeable-ingress-type</code></td></tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># No direct equivalent
# Canary/traffic-splitting uses separate
# canary annotations</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># Master Ingress (server-level config)
annotations:
  nginx.org/mergeable-ingress-type: "master"
---
# Minion Ingress (route-level config)
annotations:
  nginx.org/mergeable-ingress-type: "minion"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> Mergeable Ingress types allow splitting configuration across multiple Ingress resources for the same host. The <code>master</code> handles server-level settings while <code>minion</code> resources define individual routes.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)"><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-set-headers</code></td></tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># Custom headers set via ConfigMap
# proxy-set-headers in controller ConfigMap</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-set-headers: "my-custom-headers"
---
# ConfigMap with custom headers
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-custom-headers
data:
  X-Custom-Header: "my-value"
  X-Forwarded-Proto: "$scheme"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> References a ConfigMap containing header key-value pairs that will be added to proxied requests. The annotation value is the ConfigMap name.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)"><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/http-redirect-code</code></td></tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># No direct equivalent
# Redirect code is not configurable
# per Ingress resource</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/redirect-to-https: "True"
  nginx.org/http-redirect-code: "308"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> Customizes the HTTP redirect status code used when redirecting to HTTPS (default: 301). Common values: 301 (permanent), 302 (temporary), 307 (temporary, preserves method), 308 (permanent, preserves method).</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>
            <div class="info-box note"><strong>Note:</strong> <code>nginx.org/listen-ports</code> and <code>nginx.org/listen-ports-ssl</code> configure custom HTTP/HTTPS ports. <code>nginx.org/mergeable-ingress-type</code> enables master/minion Ingress merging for shared server-level config. <code>nginx.org/proxy-set-headers</code> sets custom proxy headers. <code>nginx.org/http-redirect-code</code> customizes the HTTP redirect status code (default: 301).</div>

            <!-- Proxy Settings -->
            <h3 id="proxy-settings">Proxy Settings</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/proxy-next-upstream</code><code>nginx.ingress.kubernetes.io/proxy-next-upstream-timeout</code><code>nginx.ingress.kubernetes.io/proxy-next-upstream-tries</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>upstreams[].next-upstream*</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-next-upstream: "error timeout"
  nginx.ingress.kubernetes.io/proxy-next-upstream-timeout: "30"
  nginx.ingress.kubernetes.io/proxy-next-upstream-tries: "3"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  upstreams:
    - name: backend
      service: my-service
      port: 80
      next-upstream: "error timeout"
      next-upstream-timeout: 30s
      next-upstream-tries: 3</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Rate Limiting -->
            <h3 id="rate-limiting">Rate Limiting</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/limit-burst-multiplier</code><code>nginx.ingress.kubernetes.io/limit-connections</code><code>nginx.ingress.kubernetes.io/limit-rate</code><code>nginx.ingress.kubernetes.io/limit-rate-after</code><code>nginx.ingress.kubernetes.io/limit-rpm</code><code>nginx.ingress.kubernetes.io/limit-rps</code><code>nginx.ingress.kubernetes.io/limit-whitelist</code></div></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/limit-req-*</code> or <span class="badge badge-policy">Policy CRD</span> <code>rateLimit</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="approach-tabs">
                                <button class="approach-tab active" onclick="switchApproach(this, 'annotation')">Annotation Approach</button>
                                <button class="approach-tab" onclick="switchApproach(this, 'crd')">CRD Approach</button>
                            </div>
                            <div class="approach-content active" data-approach="annotation">
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/limit-rps: "10"
  nginx.ingress.kubernetes.io/limit-burst-multiplier: "5"</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/limit-req-rate: "10r/s"
  nginx.org/limit-req-burst: "50"
  nginx.org/limit-req-delay: "5"</code></pre></div>
                                </div>
                                <div class="info-box note"><strong>Additional rate limiting annotations:</strong> <code>nginx.org/limit-req-key</code> (default: <code>${binary_remote_addr}</code>), <code>nginx.org/limit-req-zone-size</code>, <code>nginx.org/limit-req-no-delay</code>, <code>nginx.org/limit-req-dry-run</code>, <code>nginx.org/limit-req-log-level</code>, <code>nginx.org/limit-req-reject-code</code> (default: 429), <code>nginx.org/limit-req-scale</code> (divides rate by pod count for consistency during autoscaling).</div>
                            </div>
                            <div class="approach-content" data-approach="crd">
                                <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                    <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                                </div>
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/limit-rps: "10"
  nginx.ingress.kubernetes.io/limit-burst-multiplier: "5"</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: rate-limit
spec:
  rateLimit:
    rate: 10r/s
    burst: 50
    key: ${binary_remote_addr}
    zoneSize: 10M
    rejectCode: 429</code></pre></div>
                                </div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Redirects -->
            <h3 id="redirects">Redirects</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/from-to-www-redirect</code><code>nginx.ingress.kubernetes.io/permanent-redirect</code><code>nginx.ingress.kubernetes.io/permanent-redirect-code</code><code>nginx.ingress.kubernetes.io/temporal-redirect</code><code>nginx.ingress.kubernetes.io/temporal-redirect-code</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <code>action.redirect</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/permanent-redirect: "https://new.example.com"
  nginx.ingress.kubernetes.io/permanent-redirect-code: "308"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  host: old.example.com
  routes:
    - path: /
      action:
        redirect:
          url: https://new.example.com${request_uri}
          code: 308</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Rewrites -->
            <h3 id="rewrites">Rewrites</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/app-root</code><code>nginx.ingress.kubernetes.io/rewrite-target</code><code>nginx.ingress.kubernetes.io/use-regex</code></div></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/rewrites</code>, <code>nginx.org/rewrite-target</code>, or <code>nginx.org/app-root</code>; or <span class="badge badge-virtualserver">VirtualServer CRD</span> <code>rewritePath</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="approach-tabs">
                                <button class="approach-tab active" onclick="switchApproach(this, 'annotation')">Annotation Approach</button>
                                <button class="approach-tab" onclick="switchApproach(this, 'crd')">CRD Approach</button>
                            </div>
                            <div class="approach-content active" data-approach="annotation">
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/rewrite-target: /$2
  nginx.ingress.kubernetes.io/use-regex: "true"
# path: /api(/|$)(.*)</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/rewrites: "serviceName=api-svc rewrite=/api"
  nginx.org/path-regex: "case_sensitive"</code></pre></div>
                                </div>
                            </div>
                            <div class="approach-content" data-approach="crd">
                                <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                    <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                                </div>
                                <div class="comparison">
                                    <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/rewrite-target: /$2
  nginx.ingress.kubernetes.io/use-regex: "true"
# path: /api(/|$)(.*)</code></pre></div>
                                    <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  routes:
    - path: ~ ^/api(/|$)(.*)
      action:
        proxy:
          upstream: api
          rewritePath: /$2</code></pre></div>
                                </div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/proxy-redirect-from</code><code>nginx.ingress.kubernetes.io/proxy-redirect-to</code></div></td>
                            <td><span class="badge badge-configmap">ConfigMap</span> or <span class="badge badge-annotation">Annotation</span> <code>nginx.org/server-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-redirect-from: "http://internal/"
  nginx.ingress.kubernetes.io/proxy-redirect-to: "https://external/"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/server-snippets: |
    proxy_redirect http://internal/ https://external/;</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/proxy-cookie-domain</code><code>nginx.ingress.kubernetes.io/proxy-cookie-path</code></div></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-cookie-domain: "internal.example.com external.example.com"
  nginx.ingress.kubernetes.io/proxy-cookie-path: "/internal/ /external/"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/location-snippets: |
    proxy_cookie_domain internal.example.com external.example.com;
    proxy_cookie_path /internal/ /external/;</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The Official controller does not have dedicated annotations for proxy cookie rewriting. Use <code>location-snippets</code> to configure <code>proxy_cookie_domain</code> and <code>proxy_cookie_path</code> directives.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Route Delegation -->
            <h3 id="route-delegation">Route Delegation</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><em>N/A</em></td>
                            <td><span class="badge badge-virtualserverroute">VirtualServerRoute CRD</span> <code>routes[].route</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box">
                                <h6>Install Required CRDs <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The community controller has no equivalent for cross-namespace route delegation. VirtualServerRoute allows different teams to manage their own routing rules while a central VirtualServer controls the domain.</div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># No equivalent — each team must have
# their own Ingress resource per host,
# or share a single Ingress manifest</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># VirtualServer (platform team)
apiVersion: k8s.nginx.org/v1
kind: VirtualServer
metadata:
  name: main-app
  namespace: platform
spec:
  host: app.example.com
  routes:
    - path: /api
      route: api-team/api-routes
    - path: /web
      route: web-team/web-routes
---
# VirtualServerRoute (API team)
apiVersion: k8s.nginx.org/v1
kind: VirtualServerRoute
metadata:
  name: api-routes
  namespace: api-team
spec:
  host: app.example.com
  upstreams:
    - name: api-v1
      service: api-v1-service
      port: 80
  subroutes:
    - path: /api/v1
      action:
        pass: api-v1</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- SSL/TLS -->
            <h3 id="ssl-tls">SSL/TLS</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/backend-protocol</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/ssl-services</code> or <code>nginx.org/grpc-services</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/ssl-services: "my-service"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> For gRPC backends, use <code>nginx.org/grpc-services: "my-service"</code> instead.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/force-ssl-redirect</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/redirect-to-https</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/force-ssl-redirect: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/redirect-to-https: "true"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> <code>force-ssl-redirect</code> in the Community controller forces HTTPS redirect even without a TLS certificate. Use <code>nginx.org/redirect-to-https</code> for similar behavior.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/ssl-ciphers</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/ssl-ciphers</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/ssl-ciphers: "HIGH:!aNULL:!MD5"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/ssl-ciphers: "HIGH:!aNULL:!MD5"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/ssl-prefer-server-ciphers</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/ssl-prefer-server-ciphers</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/ssl-prefer-server-ciphers: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/ssl-prefer-server-ciphers: "true"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/ssl-redirect</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/redirect-to-https</code> or <code>nginx.org/ssl-redirect</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/ssl-redirect: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  # Option 1: For TLS terminated at load balancer
  nginx.org/redirect-to-https: "true"
  # OR Option 2: For unconditional redirect
  nginx.org/ssl-redirect: "true"</code></pre></div>
                            </div>
                            <div class="info-box tip"><strong>Important distinction:</strong>
                                <ul style="margin: 8px 0 0 20px;">
                                    <li><code>nginx.org/redirect-to-https</code> checks the <code>X-Forwarded-Proto</code> header before redirecting. Use this when TLS terminates at a load balancer in front of NGINX.</li>
                                    <li><code>nginx.org/ssl-redirect</code> performs an unconditional redirect for all HTTP traffic. Use this when NGINX handles TLS termination directly.</li>
                                </ul>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> The legacy annotation <code>ingress.kubernetes.io/ssl-redirect</code> is deprecated and will be removed in a future release. Use <code>nginx.org/ssl-redirect</code> instead.</div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/ssl-passthrough</code></td>
                            <td><span class="badge badge-transportserver">TransportServer CRD</span> <code>TLS_PASSTHROUGH</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install TransportServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/ssl-passthrough: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># GlobalConfiguration (once per cluster)
apiVersion: k8s.nginx.org/v1
kind: GlobalConfiguration
spec:
  listeners:
    - name: tls-passthrough
      port: 443
      protocol: TLS_PASSTHROUGH
---
apiVersion: k8s.nginx.org/v1
kind: TransportServer
spec:
  listener:
    name: tls-passthrough
    protocol: TLS_PASSTHROUGH
  host: secure.example.com
  upstreams:
    - name: backend
      service: secure-svc
      port: 443
  action:
    pass: backend</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/preserve-trailing-slash</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/location-snippets</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/preserve-trailing-slash: "true"
  nginx.ingress.kubernetes.io/ssl-redirect: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/redirect-to-https: "true"
  nginx.org/location-snippets: |
    # Trailing slash is preserved by default in redirects</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> This annotation affects SSL redirect behavior in the Community controller. The Official controller preserves trailing slashes by default in its redirect logic.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- TCP/UDP -->
            <h3 id="tcp-udp">TCP/UDP Load Balancing</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/stream-snippet</code><code>tcp-services ConfigMap</code><code>udp-services ConfigMap</code></div></td>
                            <td><span class="badge badge-transportserver">TransportServer CRD</span></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install TransportServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># ConfigMap for TCP services
apiVersion: v1
kind: ConfigMap
metadata:
  name: tcp-services
data:
  3306: "default/mysql:3306"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code># GlobalConfiguration
apiVersion: k8s.nginx.org/v1
kind: GlobalConfiguration
spec:
  listeners:
    - name: mysql-tcp
      port: 3306
      protocol: TCP
---
apiVersion: k8s.nginx.org/v1
kind: TransportServer
spec:
  listener:
    name: mysql-tcp
    protocol: TCP
  upstreams:
    - name: mysql
      service: mysql
      port: 3306
  action:
    pass: mysql</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Timeouts -->
            <h3 id="timeouts">Timeouts</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-connect-timeout</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-connect-timeout</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-connect-timeout: "10"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-connect-timeout: "10s"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-read-timeout</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-read-timeout</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-read-timeout: "60"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-read-timeout: "60s"</code></pre></div>
                            </div>
                        </div></td></tr>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><code>nginx.ingress.kubernetes.io/proxy-send-timeout</code></td>
                            <td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/proxy-send-timeout</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/proxy-send-timeout: "60"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress</h5><pre><code>annotations:
  nginx.org/proxy-send-timeout: "60s"</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Upstream Configuration -->
            <h3 id="upstream-configuration">Upstream Configuration</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/fail-timeout</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/keepalive</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/max-conns</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/max-fails</code></td></tr>
                        <tr><td><em>N/A</em></td><td><span class="badge badge-annotation">Annotation</span> <code>nginx.org/upstream-zone-size</code></td></tr>
                    </tbody>
                </table>
            </div>
            <div class="info-box note"><strong>Note:</strong> These are Official NGINX-only annotations for fine-tuning upstream behavior. The community controller does not provide per-annotation control over these settings.</div>
        </section>

        <!-- Plus Mappings -->
        <section id="plus-mappings">
            <h2 id="plus-mappings-heading">NGINX Plus Mappings</h2>
            <p>These features require an NGINX Plus subscription and provide enterprise-grade capabilities. Most Plus features use CRD-based configuration—click the expandable rows <span style="color: var(--primary-color);">▶</span> to see full examples.</p>

            <div class="controls">
                <input type="text" id="searchInputPlus" placeholder="Search annotations..." onkeyup="filterTable('plus')" aria-label="Search Plus annotations">
                <span id="searchCountPlus" class="search-count" aria-live="polite"></span>
                <button class="btn btn-primary" onclick="expandAllExamples(this)">Expand All</button>
                <button class="btn btn-secondary" onclick="collapseAllExamples(this)">Collapse All</button>
            </div>

            <div class="legend">
                <div class="legend-item"><span class="badge badge-plus">Plus Required</span></div>
                <div class="legend-item"><span class="badge badge-annotation">Annotation</span></div>
                <div class="legend-item"><span class="badge badge-virtualserver">VirtualServer CRD</span></div>
                <div class="legend-item"><span class="badge badge-virtualserverroute">VirtualServerRoute CRD</span></div>
                <div class="legend-item"><span class="badge badge-policy">Policy CRD</span></div>
            </div>

            <!-- API Key Authentication -->
            <h3 id="api-key-authentication">API Key Authentication</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><em>No direct equivalent</em></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <span class="badge badge-plus">Plus</span> <code>apiKey</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># No direct equivalent
# Requires custom Lua or external service</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: v1
kind: Secret
metadata:
  name: api-keys
type: nginx.org/apikey
data:
  client1: YXBpa2V5MTIzNDU=
---
apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: api-key-auth
spec:
  apiKey:
    suppliedIn:
      header: [X-API-Key]
      query: [api_key]
    clientSecret: api-keys</code></pre></div>
                            </div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Health Checks -->
            <h3 id="health-checks">Health Checks</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><em>No direct equivalent</em><em>(passive only)</em></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <span class="badge badge-plus">Plus</span> <code>upstreams[].healthCheck</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># No active health check equivalent
# Only passive health checks available</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  upstreams:
    - name: backend
      service: my-service
      port: 80
      healthCheck:
        enable: true
        path: /health
        interval: 5s
        jitter: 2s
        fails: 3
        passes: 2
        port: 8080
        statusMatch: "200-399"
        mandatory: true
        persistent: true</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> Related annotations: <code>nginx.com/health-checks</code>, <code>nginx.com/health-checks-mandatory</code>, <code>nginx.com/slow-start</code>. Active health checks require NGINX Plus.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- JWT Authentication -->
            <h3 id="jwt-authentication">JWT Authentication</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><em>No direct equivalent</em></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <span class="badge badge-plus">Plus</span> <code>jwt</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code># No direct equivalent
# Requires external auth service</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: jwt-auth
spec:
  jwt:
    realm: "API"
    jwksURI: "https://idp.example.com/.well-known/jwks.json"
    token: "$http_authorization"
    keyCache: 1h</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> JWT can also be configured via annotations: <code>nginx.com/jwt-key</code>, <code>nginx.com/jwt-realm</code>, <code>nginx.com/jwt-token</code>, <code>nginx.com/jwt-login-url</code>. The Policy CRD approach is recommended for new deployments.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- OIDC Authentication -->
            <h3 id="oidc-authentication">OIDC Authentication</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/auth-cache-duration</code><code>nginx.ingress.kubernetes.io/auth-cache-key</code><code>nginx.ingress.kubernetes.io/auth-method</code><code>nginx.ingress.kubernetes.io/auth-proxy-set-headers</code><code>nginx.ingress.kubernetes.io/auth-request-redirect</code><code>nginx.ingress.kubernetes.io/auth-response-headers</code><code>nginx.ingress.kubernetes.io/auth-signin</code><code>nginx.ingress.kubernetes.io/auth-signin-redirect-param</code><code>nginx.ingress.kubernetes.io/auth-url</code></div></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <span class="badge badge-plus">Plus</span> <code>oidc</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/auth-url: "https://auth.example.com/oauth2/auth"
  nginx.ingress.kubernetes.io/auth-signin: "https://auth.example.com/oauth2/start"
  nginx.ingress.kubernetes.io/auth-response-headers: "X-Auth-User"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: v1
kind: Secret
metadata:
  name: oidc-secret
type: nginx.org/oidc
data:
  client-secret: c2VjcmV0...
---
apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: oidc-auth
spec:
  oidc:
    clientID: "my-client-id"
    clientSecret: oidc-secret
    authEndpoint: "https://idp.example.com/authorize"
    tokenEndpoint: "https://idp.example.com/token"
    jwksURI: "https://idp.example.com/.well-known/jwks.json"
    scope: "openid+profile+email"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> Native OIDC support eliminates the need for oauth2-proxy sidecar. The community <code>auth-url</code>/<code>auth-signin</code> pattern uses the <code>auth_request</code> module (typically with oauth2-proxy) and supports any external auth service, not just OIDC. If you need generic external auth (non-OIDC), use <code>nginx.org/location-snippets</code> with the <code>auth_request</code> directive.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- Session Affinity -->
            <h3 id="session-affinity">Session Affinity / Sticky Sessions</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/affinity: "cookie"</code><code>nginx.ingress.kubernetes.io/affinity-mode</code><code>nginx.ingress.kubernetes.io/session-cookie-change-on-failure</code><code>nginx.ingress.kubernetes.io/session-cookie-conditional-samesite-none</code><code>nginx.ingress.kubernetes.io/session-cookie-domain</code><code>nginx.ingress.kubernetes.io/session-cookie-expires</code><code>nginx.ingress.kubernetes.io/session-cookie-max-age</code><code>nginx.ingress.kubernetes.io/session-cookie-name</code><code>nginx.ingress.kubernetes.io/session-cookie-path</code><code>nginx.ingress.kubernetes.io/session-cookie-samesite</code><code>nginx.ingress.kubernetes.io/session-cookie-secure</code></div></td>
                            <td><span class="badge badge-virtualserver">VirtualServer CRD</span> <span class="badge badge-plus">Plus</span> <code>sessionCookie</code></td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install VirtualServer CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/affinity: "cookie"
  nginx.ingress.kubernetes.io/session-cookie-name: "SERVERID"
  nginx.ingress.kubernetes.io/session-cookie-expires: "172800"
  nginx.ingress.kubernetes.io/session-cookie-path: "/"
  nginx.ingress.kubernetes.io/session-cookie-secure: "true"
  nginx.ingress.kubernetes.io/session-cookie-samesite: "Strict"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: VirtualServer
spec:
  upstreams:
    - name: backend
      service: my-service
      port: 80
      sessionCookie:
        enable: true
        name: SERVERID
        expires: 48h
        path: /
        secure: true
        httpOnly: true
        samesite: strict</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> Session persistence can also be configured via the <code>nginx.com/sticky-cookie-services</code> annotation for simpler use cases. The VirtualServer CRD <code>sessionCookie</code> approach provides more granular control.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>

            <!-- WAF -->
            <h3 id="waf">WAF (Web Application Firewall)</h3>
            <div class="table-wrapper">
                <table class="mapping-table"><thead><tr><th>Kubernetes NGINX Ingress</th><th>Official NGINX Ingress</th></tr></thead>
                    <tbody>
                        <tr class="expandable" onclick="toggleRow(this)">
                            <td><div class="annotation-list"><code>nginx.ingress.kubernetes.io/enable-modsecurity</code><code>nginx.ingress.kubernetes.io/enable-owasp-core-rules</code><code>nginx.ingress.kubernetes.io/modsecurity-snippet</code><code>nginx.ingress.kubernetes.io/modsecurity-transaction-id</code></div></td>
                            <td><span class="badge badge-policy">Policy CRD</span> <span class="badge badge-plus">Plus</span> <code>waf</code> (NGINX App Protect)</td>
                        </tr>
                        <tr class="example-row"><td colspan="2"><div class="example-content">
                            <div class="install-box"><h6>Install Policy CRD <button class="copy-btn" onclick="copyInstall(this, event)">Copy</button></h6>
                                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
                            </div>
                            <div class="comparison">
                                <div class="comparison-block old"><h5>Kubernetes NGINX Ingress</h5><pre><code>annotations:
  nginx.ingress.kubernetes.io/enable-modsecurity: "true"
  nginx.ingress.kubernetes.io/enable-owasp-core-rules: "true"</code></pre></div>
                                <div class="comparison-block new"><h5>Official NGINX Ingress (Plus)</h5><pre><code>apiVersion: k8s.nginx.org/v1
kind: Policy
metadata:
  name: waf-policy
spec:
  waf:
    enable: true
    apPolicy: "default/waf-policy"
    securityLogs:
      - enable: true
        apLogConf: "default/log-config"
        logDest: "syslog:server=syslog:514"</code></pre></div>
                            </div>
                            <div class="info-box note"><strong>Note:</strong> NGINX App Protect (NAP) provides enterprise WAF capabilities beyond ModSecurity. WAF can also be configured via annotations: <code>appprotect.f5.com/app-protect-enable</code>, <code>appprotect.f5.com/app-protect-policy</code>, <code>appprotect.f5.com/app-protect-security-log-enable</code>, <code>appprotect.f5.com/app-protect-security-log</code>, and <code>appprotect.f5.com/app-protect-security-log-destination</code>.</div>
                        </div></td></tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- CRD Features Summary -->
        <section id="features">
            <h2 id="crd-features">CRD Features Summary</h2>
            <p>The Official NGINX Ingress Controller uses Custom Resource Definitions (CRDs) to extend Kubernetes with NGINX-specific configuration. CRDs provide type-safe, validated configuration that goes beyond what standard Ingress annotations can offer.</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4><span class="badge badge-virtualserver" style="margin:0 8px 0 0">VirtualServer CRD</span> VirtualServer</h4>
                    <p class="description">The primary CRD for configuring HTTP/HTTPS load balancing. It replaces Ingress resources and provides advanced traffic management capabilities with full validation.</p>
                    <ul>
                        <li><strong>Traffic Splitting:</strong> Route percentages of traffic to different backends for canary/blue-green deployments</li>
                        <li><strong>Content-Based Routing:</strong> Route based on headers, cookies, arguments, or variables</li>
                        <li><strong>Path Rewriting:</strong> Modify request URIs with regex support before forwarding to backends</li>
                        <li><strong>Error Pages:</strong> Custom responses for specific HTTP error codes</li>
                        <li><strong>Request/Response Headers:</strong> Add, modify, or remove headers in transit</li>
                        <li><strong>Health Checks:</strong> Active health monitoring of upstream servers</li>
                        <li><strong>Session Persistence:</strong> Cookie-based sticky sessions (Plus)</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4><span class="badge badge-virtualserverroute" style="margin:0 8px 0 0">VirtualServerRoute CRD</span> VirtualServerRoute</h4>
                    <p class="description">Enables delegation of route configuration to different namespaces. Allows teams to manage their own routing rules while maintaining centralized control over the domain.</p>
                    <ul>
                        <li><strong>Cross-Namespace Routing:</strong> Reference services in different namespaces</li>
                        <li><strong>Path Delegation:</strong> Delegate path prefixes to other teams/namespaces</li>
                        <li><strong>Independent Updates:</strong> Teams update routes without modifying the parent VirtualServer</li>
                        <li><strong>Access Control:</strong> Limit which namespaces can define routes for a host</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4><span class="badge badge-policy" style="margin:0 8px 0 0">Policy CRD</span> Policy</h4>
                    <p class="description">Reusable security and traffic policies that can be attached to VirtualServers or specific routes. Policies enable consistent security controls across multiple applications.</p>
                    <ul>
                        <li><strong>Rate Limiting:</strong> Limit request rates by IP, header, or custom key</li>
                        <li><strong>Access Control:</strong> IP allowlists and denylists</li>
                        <li><strong>Basic Auth:</strong> Username/password authentication via htpasswd</li>
                        <li><strong>JWT Validation:</strong> Validate JSON Web Tokens (Plus)</li>
                        <li><strong>OIDC:</strong> Native OpenID Connect integration (Plus)</li>
                        <li><strong>API Key Auth:</strong> Authenticate via API keys in headers/query (Plus)</li>
                        <li><strong>mTLS:</strong> Client certificate verification (ingress) and backend TLS (egress)</li>
                        <li><strong>WAF:</strong> NGINX App Protect web application firewall (Plus)</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4><span class="badge badge-transportserver" style="margin:0 8px 0 0">TransportServer CRD</span> TransportServer</h4>
                    <p class="description">Configures TCP/UDP load balancing for non-HTTP protocols. Essential for databases, message queues, gaming servers, and other Layer 4 applications.</p>
                    <ul>
                        <li><strong>TCP Load Balancing:</strong> MySQL, PostgreSQL, Redis, custom TCP services</li>
                        <li><strong>UDP Load Balancing:</strong> DNS, RADIUS, gaming protocols</li>
                        <li><strong>TLS Passthrough:</strong> Pass encrypted traffic directly to backends</li>
                        <li><strong>Health Checks:</strong> TCP/UDP health monitoring</li>
                        <li><strong>Session Persistence:</strong> IP hash-based session affinity</li>
                    </ul>
                </div>

                <div class="feature-card">
                    <h4><span class="badge badge-globalconfiguration" style="margin:0 8px 0 0">GlobalConfiguration CRD</span> GlobalConfiguration</h4>
                    <p class="description">Cluster-wide configuration for the NGINX Ingress Controller. Defines global listeners for TCP/UDP and TLS passthrough that TransportServers can reference.</p>
                    <ul>
                        <li><strong>TCP/UDP Listeners:</strong> Define ports for non-HTTP traffic</li>
                        <li><strong>TLS Passthrough Listeners:</strong> Configure SNI-based routing</li>
                        <li><strong>Global Settings:</strong> Controller-wide configuration options</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Installation -->
        <section id="installation">
            <h2 id="installing-crds">Installing CRDs</h2>
            <div class="install-box"><h6>Install All CRDs</h6>
                <pre><code>kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml</code></pre>
            </div>
            <div class="info-box note"><strong>Note:</strong> The <code>crds.yaml</code> file contains all CRDs (VirtualServer, VirtualServerRoute, Policy, TransportServer, GlobalConfiguration) in a single manifest. Individual CRD files are not provided separately.</div>
            <div class="info-box note"><strong>Note:</strong> Replace <code>v5.3.2</code> with your controller version.</div>
        </section>

        <!-- Checklist -->
        <section id="checklist">
            <h2 id="migration-checklist">Migration Checklist</h2>
            <ul class="checklist">
                <li>Install CRDs (VirtualServer, Policy, TransportServer, GlobalConfiguration)</li>
                <li>Change annotation prefix from <code>nginx.ingress.kubernetes.io/</code> to <code>nginx.org/</code></li>
                <li>Convert access control annotations to Policy CRD</li>
                <li>Convert authentication to Policy CRD (basicAuth, jwt, oidc, apiKey)</li>
                <li>Convert canary/traffic splitting to VirtualServer splits/matches</li>
                <li>Convert mTLS to ingressMTLS/egressMTLS policies</li>
                <li>Convert rate limiting to Policy CRD</li>
                <li>Convert session affinity to VirtualServer sessionCookie</li>
                <li>Convert SSL passthrough to TransportServer</li>
                <li>Convert TCP/UDP services to TransportServer</li>
                <li>Test in staging environment</li>
                <li>Update monitoring and alerting</li>
            </ul>
        </section>

        <!-- Resources -->
        <section id="resources">
            <h2 id="additional-resources">Additional Resources</h2>
            <ul>
                <li><a href="https://docs.nginx.com/nginx-ingress-controller/" target="_blank" rel="noopener noreferrer">Official Documentation</a></li>
                <li><a href="https://docs.nginx.com/nginx-ingress-controller/configuration/virtualserver-and-virtualserverroute-resources/" target="_blank" rel="noopener noreferrer">VirtualServer Reference</a></li>
                <li><a href="https://docs.nginx.com/nginx-ingress-controller/configuration/policy-resource/" target="_blank" rel="noopener noreferrer">Policy Reference</a></li>
                <li><a href="https://docs.nginx.com/nginx-ingress-controller/configuration/transportserver-resource/" target="_blank" rel="noopener noreferrer">TransportServer Reference</a></li>
                <li><a href="https://github.com/nginx/kubernetes-ingress" target="_blank" rel="noopener noreferrer">GitHub Repository</a></li>
                <li><a href="https://github.com/alessfg/nginx-ingress-migration-guide" target="_blank" rel="noopener noreferrer">Contribute to This Guide</a></li>
            </ul>
        </section>
    </main>

    <footer>
        <div class="container">
            <p>NGINX Ingress Migration Guide</p>
            <p><a href="https://github.com/nginx/kubernetes-ingress" target="_blank" rel="noopener noreferrer">Official NGINX Ingress on GitHub</a> · <a href="https://github.com/alessfg/nginx-ingress-migration-guide" target="_blank" rel="noopener noreferrer">Contribute to This Guide</a></p>
        </div>
    </footer>

    <script>
        function toggleRow(row) {
            const exampleRow = row.nextElementSibling;
            if (exampleRow && exampleRow.classList.contains('example-row')) {
                row.classList.toggle('expanded');
                exampleRow.classList.toggle('visible');
                var isExpanded = row.classList.contains('expanded');
                row.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');
            }
        }

        // Add keyboard accessibility to expandable rows and approach tabs
        document.addEventListener('DOMContentLoaded', function() {
            // Expandable rows
            document.querySelectorAll('.expandable').forEach(function(row) {
                row.setAttribute('tabindex', '0');
                row.setAttribute('role', 'button');
                row.setAttribute('aria-expanded', 'false');
                row.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleRow(this);
                    }
                });
            });

            // Approach tabs ARIA enhancement with arrow key navigation
            document.querySelectorAll('.approach-tabs').forEach(function(tabList, i) {
                tabList.setAttribute('role', 'tablist');
                var tabs = tabList.querySelectorAll('.approach-tab');
                tabs.forEach(function(tab) {
                    var type = tab.textContent.toLowerCase().includes('annotation') ? 'annotation' : 'crd';
                    var panelId = 'panel-' + i + '-' + type;
                    tab.setAttribute('role', 'tab');
                    tab.setAttribute('aria-selected', tab.classList.contains('active') ? 'true' : 'false');
                    tab.setAttribute('aria-controls', panelId);
                    tab.id = 'tab-' + i + '-' + type;
                });
                // Arrow key navigation per WAI-ARIA tabs pattern
                tabList.addEventListener('keydown', function(e) {
                    var tabsArr = Array.from(tabs);
                    var idx = tabsArr.indexOf(document.activeElement);
                    if (idx < 0) return;
                    if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
                        e.preventDefault();
                        var next = tabsArr[(idx + 1) % tabsArr.length];
                        next.focus();
                        next.click();
                    } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
                        e.preventDefault();
                        var prev = tabsArr[(idx - 1 + tabsArr.length) % tabsArr.length];
                        prev.focus();
                        prev.click();
                    }
                });
                var container = tabList.closest('.example-content');
                if (container) {
                    container.querySelectorAll('.approach-content').forEach(function(panel) {
                        var type = panel.getAttribute('data-approach');
                        panel.setAttribute('role', 'tabpanel');
                        panel.id = 'panel-' + i + '-' + type;
                        panel.setAttribute('aria-labelledby', 'tab-' + i + '-' + type);
                        panel.setAttribute('aria-hidden', panel.classList.contains('active') ? 'false' : 'true');
                    });
                }
            });
        });
        function expandAllExamples(btn) {
            var scope = btn ? btn.closest('section') : document;
            if (!scope) scope = document;
            scope.querySelectorAll('.expandable').forEach(row => {
                row.classList.add('expanded');
                const exampleRow = row.nextElementSibling;
                if (exampleRow && exampleRow.classList.contains('example-row')) exampleRow.classList.add('visible');
            });
        }
        function collapseAllExamples(btn) {
            var scope = btn ? btn.closest('section') : document;
            if (!scope) scope = document;
            scope.querySelectorAll('.expandable').forEach(row => {
                row.classList.remove('expanded');
                const exampleRow = row.nextElementSibling;
                if (exampleRow && exampleRow.classList.contains('example-row')) exampleRow.classList.remove('visible');
            });
        }
        var _savedExpanded = [];
        function filterTable(source) {
            var ossInput = document.getElementById('searchInput');
            var plusInput = document.getElementById('searchInputPlus');
            if (source === 'plus' && plusInput) { ossInput.value = plusInput.value; }
            else if (plusInput) { plusInput.value = ossInput.value; }
            const term = ossInput.value.toLowerCase();
            // Save expanded state when search begins
            if (term && _savedExpanded.length === 0) {
                document.querySelectorAll('.expandable.expanded').forEach(function(r) { _savedExpanded.push(r); });
            }
            var totalVisible = 0;
            var totalRows = 0;
            document.querySelectorAll('.mapping-table').forEach(table => {
                let visibleCount = 0;
                table.querySelectorAll('tbody tr').forEach(row => {
                    if (row.classList.contains('example-row')) {
                        if (term) { row.classList.remove('visible'); row.previousElementSibling?.classList.remove('expanded'); }
                        return;
                    }
                    totalRows++;
                    const match = !term || row.textContent.toLowerCase().includes(term);
                    row.style.display = match ? '' : 'none';
                    if (match) visibleCount++;
                });
                totalVisible += visibleCount;
                const wrapper = table.closest('.table-wrapper');
                if (!wrapper) return;
                const h3 = wrapper.previousElementSibling;
                const infoBox = wrapper.nextElementSibling;
                const hidden = term && visibleCount === 0;
                wrapper.style.display = hidden ? 'none' : '';
                if (h3 && h3.tagName === 'H3') h3.style.display = hidden ? 'none' : '';
                if (infoBox && infoBox.classList.contains('info-box')) infoBox.style.display = hidden ? 'none' : '';
            });
            // Update result count displays
            var countText = '';
            var noResults = false;
            if (term) {
                countText = totalVisible + ' of ' + totalRows + ' rows';
                noResults = totalVisible === 0;
            }
            var countEl = document.getElementById('searchCount');
            var countElPlus = document.getElementById('searchCountPlus');
            if (countEl) { countEl.textContent = countText; countEl.className = 'search-count' + (noResults ? ' no-results' : ''); }
            if (countElPlus) { countElPlus.textContent = countText; countElPlus.className = 'search-count' + (noResults ? ' no-results' : ''); }
            // Restore expanded state when search is cleared
            if (!term && _savedExpanded.length > 0) {
                _savedExpanded.forEach(function(r) {
                    r.classList.add('expanded');
                    var ex = r.nextElementSibling;
                    if (ex && ex.classList.contains('example-row')) ex.classList.add('visible');
                });
                _savedExpanded = [];
            }
        }
        function switchApproach(btn, type) {
            const container = btn.closest('.example-content');
            container.querySelectorAll('.approach-tab').forEach(function(t) {
                t.classList.remove('active');
                t.setAttribute('aria-selected', 'false');
            });
            container.querySelectorAll('.approach-content').forEach(function(c) {
                c.classList.remove('active');
                c.setAttribute('aria-hidden', 'true');
            });
            btn.classList.add('active');
            btn.setAttribute('aria-selected', 'true');
            var panel = container.querySelector('.approach-content[data-approach="' + type + '"]');
            panel.classList.add('active');
            panel.setAttribute('aria-hidden', 'false');
        }
        function copyInstall(btn, e) {
            e.stopPropagation();
            const code = btn.parentElement.nextElementSibling.textContent;
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(code).then(() => {
                    btn.textContent = 'Copied!';
                    btn.classList.add('copied');
                    setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
                }).catch(() => {
                    btn.textContent = 'Failed';
                    setTimeout(() => { btn.textContent = 'Copy'; }, 2000);
                });
            } else {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = code;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    btn.textContent = 'Copied!';
                    btn.classList.add('copied');
                } catch (err) {
                    btn.textContent = 'Failed';
                }
                document.body.removeChild(textarea);
                setTimeout(() => { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
            }
        }
        document.querySelectorAll('nav a').forEach(a => {
            a.addEventListener('click', e => {
                e.preventDefault();
                document.querySelector(a.getAttribute('href')).scrollIntoView({ behavior: 'smooth' });
            });
        });
        document.querySelectorAll('h2[id], h3[id]').forEach(heading => {
            const anchor = document.createElement('a');
            anchor.className = 'heading-anchor';
            anchor.href = '#' + heading.id;
            anchor.setAttribute('aria-label', 'Permalink: ' + heading.textContent.trim());
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '16');
            svg.setAttribute('height', '16');
            svg.setAttribute('viewBox', '0 0 16 16');
            svg.setAttribute('fill', 'currentColor');
            svg.setAttribute('aria-hidden', 'true');
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.setAttribute('d', 'm7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z');
            svg.appendChild(path);
            anchor.appendChild(svg);
            heading.appendChild(anchor);
        });

        // --- YAML Migration Analyzer ---
        const ANNOTATION_MAPPINGS = [
            // Access Control
            { community: ["denylist-source-range", "whitelist-source-range"], official: "Policy CRD accessControl", type: "policy", category: "Access Control", anchor: "access-control", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "Policy", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateAccessControlPolicy" } },
            { community: ["satisfy"], official: "Annotation nginx.org/location-snippets (satisfy directive)", type: "annotation", category: "Access Control", anchor: "access-control", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "satisfy": { key: "nginx.org/location-snippets", transform: "snippetWrap", template: "satisfy ${value};" } } } },
            // Authentication (Basic)
            { community: ["auth-realm", "auth-secret", "auth-secret-type", "auth-type"], official: "Annotation nginx.org/basic-auth-* or Policy CRD basicAuth", type: "policy", category: "Authentication (Basic)", anchor: "authentication-basic", section: "oss", dualApproach: true, plusRequired: false,
              officialMapping: { annotations: { "auth-secret": { key: "nginx.org/basic-auth-secret", transform: "direct" }, "auth-realm": { key: "nginx.org/basic-auth-realm", transform: "direct" } }, crdKind: "Policy", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateBasicAuthPolicy" } },
            // Buffering
            { community: ["client-body-buffer-size"], official: "Annotation nginx.org/client-body-buffer-size", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "client-body-buffer-size": { key: "nginx.org/client-body-buffer-size", transform: "direct" } } } },
            { community: ["proxy-body-size"], official: "Annotation nginx.org/client-max-body-size", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-body-size": { key: "nginx.org/client-max-body-size", transform: "direct" } } } },
            { community: ["proxy-buffer-size"], official: "Annotation nginx.org/proxy-buffer-size", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-buffer-size": { key: "nginx.org/proxy-buffer-size", transform: "direct" } } } },
            { community: ["proxy-buffering"], official: "Annotation nginx.org/proxy-buffering", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-buffering": { key: "nginx.org/proxy-buffering", transform: "direct" } } } },
            { community: ["proxy-buffers-number"], official: "Annotation nginx.org/proxy-buffers", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-buffers-number": { key: "nginx.org/proxy-buffers", transform: "appendBufferSize" } } } },
            { community: ["proxy-busy-buffers-size"], official: "Annotation nginx.org/proxy-busy-buffers-size", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-busy-buffers-size": { key: "nginx.org/proxy-busy-buffers-size", transform: "direct" } } } },
            { community: ["proxy-max-temp-file-size"], official: "Annotation nginx.org/proxy-max-temp-file-size", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-max-temp-file-size": { key: "nginx.org/proxy-max-temp-file-size", transform: "direct" } } } },
            { community: ["proxy-request-buffering"], official: "Annotation nginx.org/location-snippets (proxy_request_buffering directive)", type: "annotation", category: "Buffering", anchor: "buffering", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-request-buffering": { key: "nginx.org/location-snippets", transform: "snippetWrap", template: "proxy_request_buffering ${value};" } } } },
            // Canary / Traffic Splitting
            { community: ["canary", "canary-by-cookie", "canary-by-header", "canary-by-header-pattern", "canary-by-header-value", "canary-weight", "canary-weight-total"], official: "VirtualServer CRD splits[]/matches[]", type: "virtualserver", category: "Canary / Traffic Splitting", anchor: "canary-traffic-splitting", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "VirtualServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateCanaryVirtualServer" } },
            // Configuration Snippets
            { community: ["configuration-snippet"], official: "Annotation nginx.org/location-snippets", type: "annotation", category: "Configuration Snippets", anchor: "configuration-snippets", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "configuration-snippet": { key: "nginx.org/location-snippets", transform: "direct" } } } },
            { community: ["server-snippet"], official: "Annotation nginx.org/server-snippets", type: "annotation", category: "Configuration Snippets", anchor: "configuration-snippets", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "server-snippet": { key: "nginx.org/server-snippets", transform: "direct" } } } },
            { community: ["stream-snippet"], official: "TransportServer CRD or GlobalConfiguration", type: "transportserver", category: "Configuration Snippets", anchor: "configuration-snippets", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "TransportServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateStreamSnippetTS" } },
            // CORS
            { community: ["cors-allow-credentials", "cors-allow-headers", "cors-allow-methods", "cors-allow-origin", "cors-expose-headers", "cors-max-age", "enable-cors"], official: "Annotation nginx.org/server-snippets or location-snippets (CORS headers)", type: "annotation", category: "CORS", anchor: "cors", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "enable-cors": { key: "nginx.org/server-snippets", transform: "corsSnippet" } } } },
            // Error Handling
            { community: ["custom-http-errors", "default-backend"], official: "VirtualServer CRD errorPages[]", type: "virtualserver", category: "Error Handling", anchor: "error-handling", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "VirtualServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateErrorPagesVirtualServer" } },
            // Headers
            { community: ["connection-proxy-header"], official: "Snippets or ConfigMap", type: "configmap", category: "Headers", anchor: "headers", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "connection-proxy-header": { key: "nginx.org/location-snippets", transform: "snippetWrap", template: "proxy_set_header Connection \"${value}\";" } } } },
            { community: ["custom-headers"], official: "VirtualServer CRD responseHeaders.add", type: "virtualserver", category: "Headers", anchor: "headers", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "VirtualServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateCustomHeadersVS" } },
            { community: ["proxy-hide-headers"], official: "Annotation nginx.org/proxy-hide-headers", type: "annotation", category: "Headers", anchor: "headers", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-hide-headers": { key: "nginx.org/proxy-hide-headers", transform: "direct" } } } },
            { community: ["proxy-pass-headers"], official: "Annotation nginx.org/proxy-pass-headers", type: "annotation", category: "Headers", anchor: "headers", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-pass-headers": { key: "nginx.org/proxy-pass-headers", transform: "direct" } } } },
            { community: ["upstream-vhost", "x-forwarded-prefix"], official: "VirtualServer CRD requestHeaders.set", type: "virtualserver", category: "Headers", anchor: "headers", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "VirtualServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateRequestHeadersVS" } },
            // Load Balancing
            { community: ["load-balance"], official: "Annotation nginx.org/lb-method", type: "annotation", category: "Load Balancing", anchor: "load-balancing", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "load-balance": { key: "nginx.org/lb-method", transform: "direct" } } } },
            { community: ["service-upstream"], official: "Annotation nginx.org/use-cluster-ip", type: "annotation", category: "Load Balancing", anchor: "load-balancing", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "service-upstream": { key: "nginx.org/use-cluster-ip", transform: "direct" } } } },
            { community: ["upstream-hash-by", "upstream-hash-by-subset", "upstream-hash-by-subset-size"], official: "VirtualServer CRD upstreams[].lb-method", type: "virtualserver", category: "Load Balancing", anchor: "load-balancing", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "VirtualServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateHashLBVirtualServer" } },
            // mTLS (Client)
            { community: ["auth-tls-error-page", "auth-tls-pass-certificate-to-upstream", "auth-tls-secret", "auth-tls-verify-client", "auth-tls-verify-depth"], official: "Policy CRD ingressMTLS", type: "policy", category: "mTLS (Client)", anchor: "mtls-client", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "Policy", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateIngressMTLSPolicy" } },
            { community: ["auth-tls-match-cn"], official: "Annotation nginx.org/location-snippets", type: "annotation", category: "mTLS (Client)", anchor: "mtls-client", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "auth-tls-match-cn": { key: "nginx.org/location-snippets", transform: "snippetWrap", template: "if ($ssl_client_s_dn !~ \"${value}\") { return 403; }" } } } },
            // mTLS (Backend)
            { community: ["proxy-ssl-ciphers", "proxy-ssl-name", "proxy-ssl-protocols", "proxy-ssl-secret", "proxy-ssl-server-name", "proxy-ssl-verify", "proxy-ssl-verify-depth"], official: "Policy CRD egressMTLS", type: "policy", category: "mTLS (Backend)", anchor: "mtls-backend", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "Policy", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateEgressMTLSPolicy" } },
            // Miscellaneous
            { community: ["enable-access-log"], official: "ConfigMap access-log-off", type: "configmap", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { configMap: { "enable-access-log": { key: "access-log-off", transform: "booleanInvert" } } } },
            { community: ["enable-rewrite-log"], official: "Annotation nginx.org/location-snippets (rewrite_log directive)", type: "annotation", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "enable-rewrite-log": { key: "nginx.org/location-snippets", transform: "snippetWrap", template: "rewrite_log ${value};" } } } },
            { community: ["enable-opentelemetry"], official: "ConfigMap otel-* keys (otel-exporter-endpoint, otel-trace-in-http)", type: "configmap", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { configMap: { "enable-opentelemetry": { key: "otel-trace-in-http", transform: "direct" } } } },
            { community: ["http2-push-preload"], official: "Not supported (HTTP/2 Server Push was removed from NGINX 1.25.1)", type: "unsupported", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: {} },
            { community: ["mirror-target", "mirror-request-body", "mirror-host"], official: "Annotation nginx.org/location-snippets with mirror directive", type: "annotation", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "mirror-target": { key: "nginx.org/location-snippets", transform: "snippetWrap", template: "mirror /mirror;\nmirror_request_body on;" } } } },
            { community: ["proxy-http-version"], official: "Annotation nginx.org/location-snippets", type: "annotation", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-http-version": { key: "nginx.org/location-snippets", transform: "snippetWrap", template: "proxy_http_version ${value};" } } } },
            { community: ["server-alias"], official: "Create additional VirtualServer resources", type: "virtualserver", category: "Miscellaneous", anchor: "miscellaneous", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "VirtualServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateServerAliasVS" } },
            // Proxy Settings
            { community: ["proxy-next-upstream", "proxy-next-upstream-timeout", "proxy-next-upstream-tries"], official: "VirtualServer CRD upstreams[].next-upstream*", type: "virtualserver", category: "Proxy Settings", anchor: "proxy-settings", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "VirtualServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateProxyNextUpstreamVS" } },
            // Rate Limiting
            { community: ["limit-burst-multiplier", "limit-connections", "limit-rate", "limit-rate-after", "limit-rpm", "limit-rps", "limit-whitelist"], official: "Annotation nginx.org/limit-req-* or Policy CRD rateLimit", type: "policy", category: "Rate Limiting", anchor: "rate-limiting", section: "oss", dualApproach: true, plusRequired: false,
              officialMapping: { annotations: { "limit-rps": { key: "nginx.org/limit-req-rate", transform: "appendRateUnit" }, "limit-burst-multiplier": { key: "nginx.org/limit-req-burst", transform: "direct" } }, crdKind: "Policy", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateRateLimitPolicy" } },
            // Redirects
            { community: ["from-to-www-redirect", "permanent-redirect", "permanent-redirect-code", "temporal-redirect", "temporal-redirect-code"], official: "VirtualServer CRD action.redirect", type: "virtualserver", category: "Redirects", anchor: "redirects", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "VirtualServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateRedirectVirtualServer" } },
            // Rewrites
            { community: ["app-root", "rewrite-target", "use-regex"], official: "Annotation nginx.org/rewrites or VirtualServer CRD rewritePath", type: "virtualserver", category: "Rewrites", anchor: "rewrites", section: "oss", dualApproach: true, plusRequired: false,
              officialMapping: { annotations: { "rewrite-target": { key: "nginx.org/rewrites", transform: "direct" } }, crdKind: "VirtualServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateRewriteVirtualServer" } },
            { community: ["proxy-redirect-from", "proxy-redirect-to"], official: "ConfigMap or Annotation nginx.org/server-snippets", type: "configmap", category: "Rewrites", anchor: "rewrites", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-redirect-from": { key: "nginx.org/server-snippets", transform: "proxyRedirect" } } } },
            { community: ["proxy-cookie-domain", "proxy-cookie-path"], official: "Annotation nginx.org/location-snippets", type: "annotation", category: "Rewrites", anchor: "rewrites", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-cookie-domain": { key: "nginx.org/location-snippets", transform: "snippetWrap", template: "proxy_cookie_domain ${value};" }, "proxy-cookie-path": { key: "nginx.org/location-snippets", transform: "snippetWrap", template: "proxy_cookie_path ${value};" } } } },
            // SSL/TLS
            { community: ["backend-protocol"], official: "Annotation nginx.org/ssl-services or nginx.org/grpc-services", type: "annotation", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "backend-protocol": { key: "nginx.org/ssl-services", transform: "backendProtocol" } } } },
            { community: ["force-ssl-redirect"], official: "Annotation nginx.org/redirect-to-https", type: "annotation", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "force-ssl-redirect": { key: "nginx.org/redirect-to-https", transform: "direct" } } } },
            { community: ["ssl-ciphers"], official: "Annotation nginx.org/ssl-ciphers", type: "annotation", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "ssl-ciphers": { key: "nginx.org/ssl-ciphers", transform: "direct" } } } },
            { community: ["ssl-prefer-server-ciphers"], official: "Annotation nginx.org/ssl-prefer-server-ciphers", type: "annotation", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "ssl-prefer-server-ciphers": { key: "nginx.org/ssl-prefer-server-ciphers", transform: "direct" } } } },
            { community: ["ssl-redirect"], official: "Annotation nginx.org/redirect-to-https", type: "annotation", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "ssl-redirect": { key: "nginx.org/redirect-to-https", transform: "direct" } } } },
            { community: ["ssl-passthrough"], official: "TransportServer CRD TLS_PASSTHROUGH", type: "transportserver", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { crdKind: "TransportServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateSSLPassthroughTransportServer" } },
            { community: ["preserve-trailing-slash"], official: "Annotation nginx.org/location-snippets (default behavior)", type: "annotation", category: "SSL/TLS", anchor: "ssl-tls", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "preserve-trailing-slash": { key: "nginx.org/location-snippets", transform: "direct" } } } },
            // Timeouts
            { community: ["proxy-connect-timeout"], official: "Annotation nginx.org/proxy-connect-timeout", type: "annotation", category: "Timeouts", anchor: "timeouts", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-connect-timeout": { key: "nginx.org/proxy-connect-timeout", transform: "appendTimeUnit" } } } },
            { community: ["proxy-read-timeout"], official: "Annotation nginx.org/proxy-read-timeout", type: "annotation", category: "Timeouts", anchor: "timeouts", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-read-timeout": { key: "nginx.org/proxy-read-timeout", transform: "appendTimeUnit" } } } },
            { community: ["proxy-send-timeout"], official: "Annotation nginx.org/proxy-send-timeout", type: "annotation", category: "Timeouts", anchor: "timeouts", section: "oss", dualApproach: false, plusRequired: false,
              officialMapping: { annotations: { "proxy-send-timeout": { key: "nginx.org/proxy-send-timeout", transform: "appendTimeUnit" } } } },
            // Plus: OIDC
            { community: ["auth-cache-duration", "auth-cache-key", "auth-method", "auth-proxy-set-headers", "auth-request-redirect", "auth-response-headers", "auth-signin", "auth-signin-redirect-param", "auth-url"], official: "Policy CRD oidc", type: "policy", category: "OIDC Authentication", anchor: "oidc-authentication", section: "plus", dualApproach: false, plusRequired: true,
              officialMapping: { crdKind: "Policy", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateOIDCPolicy" } },
            // Plus: Session Affinity
            { community: ["affinity", "affinity-mode", "session-cookie-change-on-failure", "session-cookie-conditional-samesite-none", "session-cookie-domain", "session-cookie-expires", "session-cookie-max-age", "session-cookie-name", "session-cookie-path", "session-cookie-samesite", "session-cookie-secure"], official: "VirtualServer CRD sessionCookie", type: "virtualserver", category: "Session Affinity", anchor: "session-affinity", section: "plus", dualApproach: false, plusRequired: true,
              officialMapping: { crdKind: "VirtualServer", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateSessionAffinityVS" } },
            // Plus: WAF
            { community: ["enable-modsecurity", "enable-owasp-core-rules", "modsecurity-snippet", "modsecurity-transaction-id"], official: "Policy CRD waf (NGINX App Protect)", type: "policy", category: "WAF", anchor: "waf", section: "plus", dualApproach: false, plusRequired: true,
              officialMapping: { crdKind: "Policy", crdInstall: "kubectl apply -f https://raw.githubusercontent.com/nginx/kubernetes-ingress/v5.3.2/deploy/crds.yaml", templateFn: "generateWAFPolicy" } }
        ];

        const ANNOTATION_LOOKUP = new Map();
        ANNOTATION_MAPPINGS.forEach(function(mapping, idx) {
            mapping.community.forEach(function(name) {
                ANNOTATION_LOOKUP.set(name, idx);
            });
        });

        function parseYamlAnnotations(yamlText) {
            var results = [];
            var docs = yamlText.split(/^---\s*$/m);
            docs.forEach(function(doc, docIndex) {
                var lines = doc.split('\n');
                var inAnnotations = false;
                var annotationIndent = -1;
                for (var i = 0; i < lines.length; i++) {
                    var line = lines[i];
                    var trimmed = line.trimStart();
                    if (trimmed.startsWith('#') || trimmed === '') continue;
                    var currentIndent = line.length - line.trimStart().length;
                    if (/^\s*annotations\s*:/.test(line)) {
                        var inlineMatch = line.match(/annotations\s*:\s*\{(.+)\}/);
                        if (inlineMatch) {
                            var pairs = inlineMatch[1].split(',');
                            pairs.forEach(function(pair) {
                                var kv = pair.split(':');
                                if (kv.length >= 2) {
                                    var key = kv[0].trim().replace(/^["']|["']$/g, '');
                                    var val = kv.slice(1).join(':').trim().replace(/^["']|["']$/g, '');
                                    if (key.startsWith('nginx.ingress.kubernetes.io/')) {
                                        results.push({ annotation: key.replace('nginx.ingress.kubernetes.io/', ''), value: val, docIndex: docIndex });
                                    }
                                }
                            });
                            inAnnotations = false;
                            continue;
                        }
                        inAnnotations = true;
                        annotationIndent = currentIndent;
                        continue;
                    }
                    if (inAnnotations) {
                        if (currentIndent <= annotationIndent && trimmed !== '') {
                            inAnnotations = false;
                            annotationIndent = -1;
                            continue;
                        }
                        var kvMatch = trimmed.match(/^["']?([^"':]+)["']?\s*:\s*(.*)$/);
                        if (kvMatch) {
                            var key = kvMatch[1].trim().replace(/^["']|["']$/g, '');
                            var val = kvMatch[2].trim().replace(/^["']|["']$/g, '');
                            if (key.startsWith('nginx.ingress.kubernetes.io/')) {
                                results.push({ annotation: key.replace('nginx.ingress.kubernetes.io/', ''), value: val, docIndex: docIndex });
                            }
                        }
                    }
                }
            });
            return results;
        }

        function escapeHtml(str) {
            var d = document.createElement('div');
            d.textContent = str;
            return d.innerHTML;
        }

        var ANNOTATION_TIPS = {
            'proxy-body-size': 'Max request body size for client uploads',
            'proxy-buffer-size': 'Size of the buffer for reading proxy response headers',
            'proxy-buffering': 'Enable/disable buffering of proxy responses',
            'proxy-connect-timeout': 'Timeout for establishing a connection to the backend',
            'proxy-read-timeout': 'Timeout for reading a response from the backend',
            'proxy-send-timeout': 'Timeout for transmitting a request to the backend',
            'proxy-request-buffering': 'Enable/disable buffering of client request body',
            'proxy-next-upstream': 'Conditions to pass request to the next upstream server',
            'proxy-next-upstream-timeout': 'Max time to wait while passing to next upstream',
            'proxy-next-upstream-tries': 'Max retries for passing to next upstream',
            'ssl-redirect': 'Redirect HTTP traffic to HTTPS',
            'force-ssl-redirect': 'Force redirect to HTTPS even without TLS termination',
            'rewrite-target': 'Rewrite the URL path before forwarding to backend',
            'use-regex': 'Enable regex matching for path-based routing',
            'limit-rps': 'Max requests per second from a single IP',
            'limit-burst-multiplier': 'Multiplier for burst capacity on rate limits',
            'whitelist-source-range': 'Allow traffic only from these IP ranges (CIDR)',
            'denylist-source-range': 'Block traffic from these IP ranges (CIDR)',
            'enable-cors': 'Enable CORS headers on responses',
            'cors-allow-origin': 'Allowed origins for CORS requests',
            'cors-allow-methods': 'Allowed HTTP methods for CORS requests',
            'cors-allow-headers': 'Allowed headers in CORS requests',
            'cors-allow-credentials': 'Allow credentials in CORS requests',
            'cors-max-age': 'Max age (seconds) for CORS preflight cache',
            'cors-expose-headers': 'Headers exposed to the browser in CORS responses',
            'configuration-snippet': 'Custom NGINX config snippet injected into the location block',
            'server-snippet': 'Custom NGINX config snippet injected into the server block',
            'server-tokens': 'Show/hide NGINX version in error pages and headers',
            'backend-protocol': 'Protocol used to communicate with the backend (HTTP/HTTPS/GRPC)',
            'enable-access-log': 'Enable or disable access logging for this ingress',
            'client-header-buffer-size': 'Size of buffer for reading client request headers',
            'auth-tls-secret': 'Secret containing the CA certificate for client TLS verification',
            'auth-tls-verify-client': 'Client certificate verification mode (on/off/optional)',
            'auth-tls-verify-depth': 'Max depth of client certificate chain verification',
            'proxy-ssl-secret': 'Secret containing the client certificate for upstream TLS',
            'proxy-ssl-verify': 'Enable verification of the upstream server certificate',
            'proxy-ssl-verify-depth': 'Max depth of upstream certificate chain verification',
            'auth-type': 'Authentication type (basic)',
            'auth-secret': 'Secret containing authentication credentials',
            'auth-realm': 'Authentication realm shown in browser dialog',
            'canary': 'Enable canary deployment for this ingress',
            'canary-weight': 'Percentage of traffic routed to the canary backend',
            'canary-by-header': 'Header name to route traffic to canary',
            'canary-by-cookie': 'Cookie name to route traffic to canary',
            'permanent-redirect': 'URL for permanent (301) redirect',
            'permanent-redirect-code': 'HTTP status code for permanent redirects',
            'temporal-redirect': 'URL for temporary (302) redirect',
            'custom-http-errors': 'HTTP error codes to intercept and show custom error pages',
            'default-backend': 'Default backend service for unmatched requests',
            'ssl-passthrough': 'Pass TLS connections directly to the backend without termination',
            'stream-snippet': 'Custom NGINX stream config snippet',
            'upstream-vhost': 'Custom Host header sent to the upstream',
            'x-forwarded-prefix': 'Set X-Forwarded-Prefix header for the upstream',
            'custom-headers': 'ConfigMap containing custom response headers',
            'upstream-hash-by': 'Hash key for consistent upstream load balancing',
            'server-alias': 'Additional server names/aliases for this ingress',
            'proxy-redirect-from': 'Source URL pattern for proxy redirect rewriting',
            'proxy-redirect-to': 'Destination URL pattern for proxy redirect rewriting',
            'modsecurity-snippet': 'ModSecurity WAF configuration snippet',
            'modsecurity-transaction-id': 'Custom transaction ID for WAF audit logging',
            'auth-url': 'URL for external authentication service',
            'auth-signin': 'Sign-in URL for external authentication',
            'session-cookie-name': 'Name of the session affinity cookie',
            'session-cookie-expires': 'Expiration time for the session cookie',
            'session-cookie-path': 'Path for the session cookie',
            'session-cookie-secure': 'Mark session cookie as secure (HTTPS only)',
            'session-cookie-samesite': 'SameSite attribute for session cookie'
        };

        function translateValue(value, transform, template) {
            if (!value && value !== '0') return value;
            switch (transform) {
                case 'direct': return value;
                case 'booleanInvert': return value === 'true' ? 'false' : value === 'false' ? 'true' : value;
                case 'appendRateUnit': return /r\/[sm]$/.test(value) ? value : value + 'r/s';
                case 'appendTimeUnit': return /[smhd]$/.test(value) ? value : value + 's';
                case 'appendBufferSize': return /\s/.test(value) ? value : value + ' 8k';
                case 'snippetWrap': return template ? template.replace('${value}', value) : value;
                case 'backendProtocol': return value; // key selection handled in generateMigrationYaml
                case 'corsSnippet': return value; // handled specially in generateMigrationYaml
                case 'proxyRedirect': return value; // handled specially in generateMigrationYaml
                default: return value;
            }
        }

        function getAnnotationValue(foundAnnotations, name) {
            var found = foundAnnotations.find(function(a) { return a.annotation === name; });
            return found ? found.value : null;
        }

        var CRD_GENERATORS = {
            generateAccessControlPolicy: function(found) {
                var allow = getAnnotationValue(found, 'whitelist-source-range');
                var deny = getAnnotationValue(found, 'denylist-source-range');
                var lines = ['apiVersion: k8s.nginx.org/v1', 'kind: Policy', 'metadata:', '  name: access-control-policy', 'spec:', '  accessControl:'];
                if (allow) {
                    lines.push('    allow:');
                    allow.split(',').forEach(function(ip) { lines.push('      - ' + ip.trim()); });
                }
                if (deny) {
                    lines.push('    deny:');
                    deny.split(',').forEach(function(ip) { lines.push('      - ' + ip.trim()); });
                }
                if (!allow && !deny) { lines.push('    allow:', '      - # TODO: Set your allowed CIDRs'); }
                return lines.join('\n');
            },
            generateBasicAuthPolicy: function(found) {
                var secret = getAnnotationValue(found, 'auth-secret') || '# TODO: Set your secret name';
                var realm = getAnnotationValue(found, 'auth-realm') || 'Protected Area';
                return ['apiVersion: k8s.nginx.org/v1', 'kind: Policy', 'metadata:', '  name: basic-auth-policy', 'spec:', '  basicAuth:', '    secret: ' + secret, '    realm: "' + realm + '"'].join('\n');
            },
            generateIngressMTLSPolicy: function(found) {
                var secret = getAnnotationValue(found, 'auth-tls-secret');
                var verify = getAnnotationValue(found, 'auth-tls-verify-client');
                var depth = getAnnotationValue(found, 'auth-tls-verify-depth');
                var secretVal = secret ? secret.replace(/^[^/]+\//, '') : '# TODO: Set your CA secret';
                return ['apiVersion: k8s.nginx.org/v1', 'kind: Policy', 'metadata:', '  name: ingress-mtls-policy', 'spec:', '  ingressMTLS:', '    clientCertSecret: ' + secretVal, '    verifyClient: "' + (verify || 'on') + '"', '    verifyDepth: ' + (depth || '1')].join('\n');
            },
            generateEgressMTLSPolicy: function(found) {
                var secret = getAnnotationValue(found, 'proxy-ssl-secret');
                var verify = getAnnotationValue(found, 'proxy-ssl-verify');
                var depth = getAnnotationValue(found, 'proxy-ssl-verify-depth');
                var secretVal = secret ? secret.replace(/^[^/]+\//, '') : '# TODO: Set your client cert secret';
                var lines = ['apiVersion: k8s.nginx.org/v1', 'kind: Policy', 'metadata:', '  name: egress-mtls-policy', 'spec:', '  egressMTLS:', '    tlsSecret: ' + secretVal, '    trustedCertSecret: # TODO: Set your CA cert secret'];
                if (verify) lines.push('    verifyServer: ' + (verify === 'on' ? 'true' : 'false'));
                if (depth) lines.push('    verifyDepth: ' + depth);
                return lines.join('\n');
            },
            generateRateLimitPolicy: function(found) {
                var rps = getAnnotationValue(found, 'limit-rps');
                var burst = getAnnotationValue(found, 'limit-burst-multiplier');
                var rate = rps ? rps + 'r/s' : '# TODO: Set your rate';
                var burstVal = (rps && burst) ? String(parseInt(rps, 10) * parseInt(burst, 10)) : (burst || '5');
                return ['apiVersion: k8s.nginx.org/v1', 'kind: Policy', 'metadata:', '  name: rate-limit-policy', 'spec:', '  rateLimit:', '    rate: ' + rate, '    burst: ' + burstVal, '    key: ${binary_remote_addr}', '    zoneSize: 10M', '    rejectCode: 429'].join('\n');
            },
            generateCanaryVirtualServer: function(found) {
                var weight = getAnnotationValue(found, 'canary-weight') || '20';
                var header = getAnnotationValue(found, 'canary-by-header');
                var cookie = getAnnotationValue(found, 'canary-by-cookie');
                var mainWeight = String(100 - parseInt(weight, 10));
                var lines = ['apiVersion: k8s.nginx.org/v1', 'kind: VirtualServer', 'metadata:', '  name: canary-app', 'spec:', '  host: # TODO: Set your host', '  upstreams:', '    - name: main', '      service: # TODO: main service', '      port: 80', '    - name: canary', '      service: # TODO: canary service', '      port: 80', '  routes:', '    - path: /'];
                if (header || cookie) {
                    lines.push('      matches:');
                    if (header) { lines.push('        - conditions:', '            - header: ' + header, '              value: "true"', '          action:', '            pass: canary'); }
                    if (cookie) { lines.push('        - conditions:', '            - cookie: ' + cookie, '              value: "true"', '          action:', '            pass: canary'); }
                }
                lines.push('      splits:', '        - weight: ' + mainWeight, '          action: { pass: main }', '        - weight: ' + weight, '          action: { pass: canary }');
                return lines.join('\n');
            },
            generateRedirectVirtualServer: function(found) {
                var url = getAnnotationValue(found, 'permanent-redirect') || getAnnotationValue(found, 'temporal-redirect') || '# TODO: Set redirect URL';
                var code = getAnnotationValue(found, 'permanent-redirect-code') || (getAnnotationValue(found, 'temporal-redirect') ? '302' : '301');
                return ['apiVersion: k8s.nginx.org/v1', 'kind: VirtualServer', 'metadata:', '  name: redirect-app', 'spec:', '  host: # TODO: Set your host', '  routes:', '    - path: /', '      action:', '        redirect:', '          url: ' + url + '${request_uri}', '          code: ' + code].join('\n');
            },
            generateRewriteVirtualServer: function(found) {
                var target = getAnnotationValue(found, 'rewrite-target') || '/$2';
                return ['apiVersion: k8s.nginx.org/v1', 'kind: VirtualServer', 'metadata:', '  name: rewrite-app', 'spec:', '  host: # TODO: Set your host', '  upstreams:', '    - name: backend', '      service: # TODO: Set your service', '      port: 80', '  routes:', '    - path: ~ ^/api(/|$)(.*)', '      action:', '        proxy:', '          upstream: backend', '          rewritePath: ' + target].join('\n');
            },
            generateErrorPagesVirtualServer: function(found) {
                var codes = getAnnotationValue(found, 'custom-http-errors') || '404,500,502';
                var codeList = codes.split(',').map(function(c) { return c.trim(); });
                return ['apiVersion: k8s.nginx.org/v1', 'kind: VirtualServer', 'metadata:', '  name: error-pages-app', 'spec:', '  host: # TODO: Set your host', '  upstreams:', '    - name: backend', '      service: # TODO: Set your service', '      port: 80', '  routes:', '    - path: /', '      action:', '        pass: backend', '      errorPages:', '        - codes: [' + codeList.join(', ') + ']', '          return:', '            code: 503', '            body: "Service Unavailable"'].join('\n');
            },
            generateSSLPassthroughTransportServer: function(found) {
                return ['# GlobalConfiguration (once per cluster)', 'apiVersion: k8s.nginx.org/v1', 'kind: GlobalConfiguration', 'metadata:', '  name: nginx-configuration', '  namespace: nginx-ingress', 'spec:', '  listeners:', '    - name: tls-passthrough', '      port: 443', '      protocol: TLS_PASSTHROUGH', '---', 'apiVersion: k8s.nginx.org/v1', 'kind: TransportServer', 'metadata:', '  name: ssl-passthrough-app', 'spec:', '  listener:', '    name: tls-passthrough', '    protocol: TLS_PASSTHROUGH', '  host: # TODO: Set your host', '  upstreams:', '    - name: backend', '      service: # TODO: Set your service', '      port: 443', '  action:', '    pass: backend'].join('\n');
            },
            generateStreamSnippetTS: function(found) {
                return ['apiVersion: k8s.nginx.org/v1', 'kind: TransportServer', 'metadata:', '  name: stream-app', 'spec:', '  listener:', '    name: # TODO: Define in GlobalConfiguration', '    protocol: TCP', '  upstreams:', '    - name: backend', '      service: # TODO: Set your service', '      port: # TODO: Set port', '  action:', '    pass: backend'].join('\n');
            },
            generateCustomHeadersVS: function(found) {
                var val = getAnnotationValue(found, 'custom-headers') || 'default/custom-headers-configmap';
                return ['apiVersion: k8s.nginx.org/v1', 'kind: VirtualServer', 'metadata:', '  name: custom-headers-app', 'spec:', '  host: # TODO: Set your host', '  upstreams:', '    - name: backend', '      service: # TODO: Set your service', '      port: 80', '  routes:', '    - path: /', '      action:', '        proxy:', '          upstream: backend', '          responseHeaders:', '            add:', '              - name: # TODO: Add your headers', '                value: # TODO: Set values', '  # Note: Migrating from ConfigMap ref: ' + val].join('\n');
            },
            generateRequestHeadersVS: function(found) {
                var vhost = getAnnotationValue(found, 'upstream-vhost');
                var prefix = getAnnotationValue(found, 'x-forwarded-prefix');
                var headers = [];
                if (vhost) headers.push('              - name: Host', '                value: "' + vhost + '"');
                if (prefix) headers.push('              - name: X-Forwarded-Prefix', '                value: "' + prefix + '"');
                if (headers.length === 0) headers.push('              - name: # TODO: Set header', '                value: # TODO: Set value');
                return ['apiVersion: k8s.nginx.org/v1', 'kind: VirtualServer', 'metadata:', '  name: headers-app', 'spec:', '  host: # TODO: Set your host', '  upstreams:', '    - name: backend', '      service: # TODO: Set your service', '      port: 80', '  routes:', '    - path: /', '      action:', '        proxy:', '          upstream: backend', '          requestHeaders:', '            set:'].concat(headers).join('\n');
            },
            generateHashLBVirtualServer: function(found) {
                var hashBy = getAnnotationValue(found, 'upstream-hash-by') || '$request_uri';
                return ['apiVersion: k8s.nginx.org/v1', 'kind: VirtualServer', 'metadata:', '  name: hash-lb-app', 'spec:', '  host: # TODO: Set your host', '  upstreams:', '    - name: backend', '      service: # TODO: Set your service', '      port: 80', '      lb-method: "hash ' + hashBy + ' consistent"', '  routes:', '    - path: /', '      action:', '        pass: backend'].join('\n');
            },
            generateProxyNextUpstreamVS: function(found) {
                var conditions = getAnnotationValue(found, 'proxy-next-upstream') || 'error timeout';
                var timeout = getAnnotationValue(found, 'proxy-next-upstream-timeout');
                var tries = getAnnotationValue(found, 'proxy-next-upstream-tries');
                var lines = ['apiVersion: k8s.nginx.org/v1', 'kind: VirtualServer', 'metadata:', '  name: proxy-upstream-app', 'spec:', '  host: # TODO: Set your host', '  upstreams:', '    - name: backend', '      service: # TODO: Set your service', '      port: 80', '      next-upstream: "' + conditions + '"'];
                if (timeout) lines.push('      next-upstream-timeout: ' + (timeout.endsWith('s') ? timeout : timeout + 's'));
                if (tries) lines.push('      next-upstream-tries: ' + tries);
                lines.push('  routes:', '    - path: /', '      action:', '        pass: backend');
                return lines.join('\n');
            },
            generateServerAliasVS: function(found) {
                var alias = getAnnotationValue(found, 'server-alias') || 'alias.example.com';
                return ['# Create a separate VirtualServer per host alias', 'apiVersion: k8s.nginx.org/v1', 'kind: VirtualServer', 'metadata:', '  name: alias-app', 'spec:', '  host: ' + alias, '  upstreams:', '    - name: backend', '      service: # TODO: Set your service', '      port: 80', '  routes:', '    - path: /', '      action:', '        pass: backend'].join('\n');
            },
            generateOIDCPolicy: function(found) {
                var authUrl = getAnnotationValue(found, 'auth-url') || '# TODO: Set your auth endpoint';
                var signinUrl = getAnnotationValue(found, 'auth-signin') || '# TODO: Set your sign-in URL';
                return ['apiVersion: k8s.nginx.org/v1', 'kind: Policy', 'metadata:', '  name: oidc-policy', 'spec:', '  oidc:', '    clientID: # TODO: Set your client ID', '    clientSecret: # TODO: Create nginx.org/oidc secret', '    authEndpoint: "' + authUrl + '"', '    tokenEndpoint: # TODO: Set your token endpoint', '    jwksURI: # TODO: Set your JWKS URI', '    scope: "openid+profile+email"'].join('\n');
            },
            generateSessionAffinityVS: function(found) {
                var name = getAnnotationValue(found, 'session-cookie-name') || 'SERVERID';
                var expires = getAnnotationValue(found, 'session-cookie-expires');
                var path = getAnnotationValue(found, 'session-cookie-path') || '/';
                var secure = getAnnotationValue(found, 'session-cookie-secure');
                var samesite = getAnnotationValue(found, 'session-cookie-samesite');
                var lines = ['apiVersion: k8s.nginx.org/v1', 'kind: VirtualServer', 'metadata:', '  name: sticky-app', 'spec:', '  host: # TODO: Set your host', '  upstreams:', '    - name: backend', '      service: # TODO: Set your service', '      port: 80', '      sessionCookie:', '        enable: true', '        name: ' + name];
                if (expires) {
                    var secs = parseInt(expires, 10);
                    var hours = Math.round(secs / 3600);
                    lines.push('        expires: ' + (hours > 0 ? hours + 'h' : expires + 's'));
                }
                lines.push('        path: ' + path);
                if (secure) lines.push('        secure: ' + secure);
                lines.push('        httpOnly: true');
                if (samesite) lines.push('        samesite: ' + samesite.toLowerCase());
                lines.push('  routes:', '    - path: /', '      action:', '        pass: backend');
                return lines.join('\n');
            },
            generateWAFPolicy: function(found) {
                return ['apiVersion: k8s.nginx.org/v1', 'kind: Policy', 'metadata:', '  name: waf-policy', 'spec:', '  waf:', '    enable: true', '    apPolicy: "default/waf-policy"', '    securityLogs:', '      - enable: true', '        apLogConf: "default/log-config"', '        logDest: "syslog:server=syslog:514"'].join('\n');
            }
        };

        function generateMigrationYaml(sorted) {
            var annotationSwaps = [];
            var configMapChanges = [];
            var crdResources = [];

            sorted.forEach(function(entry) {
                var m = entry.mapping;
                var om = m.officialMapping;
                if (!om) return;

                // Annotation swaps
                if (om.annotations) {
                    // Special handling for CORS — generate one combined snippet
                    var hasCorsSnippet = Object.keys(om.annotations).some(function(k) { return om.annotations[k].transform === 'corsSnippet'; });
                    if (hasCorsSnippet) {
                        var corsOrigin = getAnnotationValue(entry.foundAnnotations, 'cors-allow-origin') || '*';
                        var corsMethods = getAnnotationValue(entry.foundAnnotations, 'cors-allow-methods') || 'GET, POST, OPTIONS';
                        var corsHeaders = getAnnotationValue(entry.foundAnnotations, 'cors-allow-headers') || 'DNT,User-Agent,X-Requested-With,Content-Type,Authorization';
                        var corsCreds = getAnnotationValue(entry.foundAnnotations, 'cors-allow-credentials');
                        var corsMaxAge = getAnnotationValue(entry.foundAnnotations, 'cors-max-age') || '86400';
                        var corsExpose = getAnnotationValue(entry.foundAnnotations, 'cors-expose-headers');
                        var snippetLines = [];
                        snippetLines.push('add_header Access-Control-Allow-Origin "' + corsOrigin + '" always;');
                        snippetLines.push('add_header Access-Control-Allow-Methods "' + corsMethods + '" always;');
                        snippetLines.push('add_header Access-Control-Allow-Headers "' + corsHeaders + '" always;');
                        if (corsCreds === 'true') snippetLines.push('add_header Access-Control-Allow-Credentials "true" always;');
                        snippetLines.push('add_header Access-Control-Max-Age ' + corsMaxAge + ' always;');
                        if (corsExpose) snippetLines.push('add_header Access-Control-Expose-Headers "' + corsExpose + '" always;');
                        snippetLines.push('if ($request_method = OPTIONS) { return 204; }');
                        var corsSnippetVal = snippetLines.join('\\n');
                        annotationSwaps.push({ from: 'nginx.ingress.kubernetes.io/enable-cors + cors-*', to: 'nginx.org/server-snippets', value: '|\\n  ' + snippetLines.join('\\n  '), originalValue: 'true (+ cors-* values)', entry: entry });
                    } else {
                        // Special handling for backend-protocol — selects correct official annotation based on value
                        var hasBackendProtocol = Object.keys(om.annotations).some(function(k) { return om.annotations[k].transform === 'backendProtocol'; });
                        if (hasBackendProtocol) {
                            entry.foundAnnotations.forEach(function(a) {
                                var spec = om.annotations[a.annotation];
                                if (spec && spec.transform === 'backendProtocol') {
                                    var upperVal = (a.value || '').toUpperCase();
                                    var targetKey = (upperVal === 'GRPC' || upperVal === 'GRPCS') ? 'nginx.org/grpc-services' : 'nginx.org/ssl-services';
                                    annotationSwaps.push({ from: 'nginx.ingress.kubernetes.io/' + a.annotation, to: targetKey, value: 'my-service', originalValue: a.value, entry: entry });
                                } else if (spec) {
                                    var translated = translateValue(a.value, spec.transform, spec.template);
                                    annotationSwaps.push({ from: 'nginx.ingress.kubernetes.io/' + a.annotation, to: spec.key, value: translated, originalValue: a.value, entry: entry });
                                }
                            });
                        // Special handling for proxy-redirect
                        } else if (Object.keys(om.annotations).some(function(k) { return om.annotations[k].transform === 'proxyRedirect'; })) {
                            var fromVal = getAnnotationValue(entry.foundAnnotations, 'proxy-redirect-from') || 'http://internal/';
                            var toVal = getAnnotationValue(entry.foundAnnotations, 'proxy-redirect-to') || 'https://external/';
                            annotationSwaps.push({ from: 'nginx.ingress.kubernetes.io/proxy-redirect-*', to: 'nginx.org/server-snippets', value: '|\\n  proxy_redirect ' + fromVal + ' ' + toVal + ';', originalValue: fromVal + ' -> ' + toVal, entry: entry });
                        } else {
                            entry.foundAnnotations.forEach(function(a) {
                                var spec = om.annotations[a.annotation];
                                if (spec) {
                                    var translated = translateValue(a.value, spec.transform, spec.template);
                                    annotationSwaps.push({ from: 'nginx.ingress.kubernetes.io/' + a.annotation, to: spec.key, value: translated, originalValue: a.value, entry: entry });
                                }
                            });
                        }
                    }
                }

                // ConfigMap changes
                if (om.configMap) {
                    entry.foundAnnotations.forEach(function(a) {
                        var spec = om.configMap[a.annotation];
                        if (spec) {
                            var translated = translateValue(a.value, spec.transform, spec.template);
                            configMapChanges.push({ from: 'nginx.ingress.kubernetes.io/' + a.annotation, to: spec.key, value: translated, originalValue: a.value, entry: entry });
                        }
                    });
                }

                // CRD resources
                if (om.crdKind && om.templateFn && CRD_GENERATORS[om.templateFn]) {
                    var yaml = CRD_GENERATORS[om.templateFn](entry.foundAnnotations);
                    crdResources.push({ kind: om.crdKind, install: om.crdInstall, yaml: yaml, entry: entry });
                }
            });

            return { annotationSwaps: annotationSwaps, configMapChanges: configMapChanges, crdResources: crdResources };
        }

        function copyAnalyzerBlock(btn) {
            var pre = btn.parentElement;
            var text = pre.getAttribute('data-raw') || pre.textContent.replace(/^Copy$|^Copied!$/m, '').trim();
            copyToClipboard(text, btn);
        }

        // Universal clipboard copy with fallback
        function copyToClipboard(text, btn) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(function() {
                    if (btn) {
                        btn.textContent = 'Copied!';
                        btn.classList.add('copied');
                        setTimeout(function() { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
                    }
                }).catch(function() {
                    fallbackCopy(text, btn);
                });
            } else {
                fallbackCopy(text, btn);
            }
        }

        function fallbackCopy(text, btn) {
            var textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                if (btn) {
                    btn.textContent = 'Copied!';
                    btn.classList.add('copied');
                }
            } catch (err) {
                if (btn) btn.textContent = 'Failed';
            }
            document.body.removeChild(textarea);
            if (btn) setTimeout(function() { btn.textContent = 'Copy'; btn.classList.remove('copied'); }, 2000);
        }

        function toggleAnalyzerDetails(btn) {
            btn.classList.toggle('expanded');
            var container = btn.nextElementSibling;
            if (container) container.classList.toggle('visible');
        }

        function analyzeYaml() {
            var yamlText = document.getElementById('yamlInput').value.trim();
            var resultsDiv = document.getElementById('analyzerResults');
            if (!yamlText) {
                showAnalyzerMessage(resultsDiv, 'error', 'No input.', 'Paste a Kubernetes Ingress YAML manifest to analyze.');
                return;
            }
            try {
            var annotations = parseYamlAnnotations(yamlText);
            if (annotations.length === 0) {
                showAnalyzerMessage(resultsDiv, 'info', 'No community NGINX annotations found.', 'Make sure your YAML contains annotations with the nginx.ingress.kubernetes.io/ prefix.');
                return;
            }
            var matchedMappings = new Map();
            var unrecognized = [];
            annotations.forEach(function(ann) {
                var idx = ANNOTATION_LOOKUP.get(ann.annotation);
                if (idx !== undefined) {
                    if (!matchedMappings.has(idx)) {
                        matchedMappings.set(idx, { mapping: ANNOTATION_MAPPINGS[idx], foundAnnotations: [] });
                    }
                    var entry = matchedMappings.get(idx);
                    if (!entry.foundAnnotations.some(function(a) { return a.annotation === ann.annotation; })) {
                        entry.foundAnnotations.push({ annotation: ann.annotation, value: ann.value });
                    }
                } else {
                    if (!unrecognized.some(function(u) { return u.annotation === ann.annotation; })) {
                        unrecognized.push(ann);
                    }
                }
            });
            var typeOrder = { policy: 0, virtualserver: 1, virtualserverroute: 2, transportserver: 3, globalconfiguration: 4, annotation: 5, configmap: 6 };
            var sorted = Array.from(matchedMappings.values()).sort(function(a, b) {
                var ta = typeOrder[a.mapping.type] !== undefined ? typeOrder[a.mapping.type] : 99;
                var tb = typeOrder[b.mapping.type] !== undefined ? typeOrder[b.mapping.type] : 99;
                if (ta !== tb) return ta - tb;
                return a.mapping.category.localeCompare(b.mapping.category);
            });
            var crdCount = sorted.filter(function(e) { return e.mapping.type !== 'annotation' && e.mapping.type !== 'configmap'; }).length;
            renderAnalyzerResults(resultsDiv, annotations.length, sorted, crdCount, unrecognized);
            // Smooth scroll to results
            setTimeout(function() {
                resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
            } catch (err) {
                showAnalyzerMessage(resultsDiv, 'error', 'Analysis failed.', 'There was an error parsing the YAML. Please check the format and try again.');
            }
        }

        function showAnalyzerMessage(container, type, title, message) {
            var div = document.createElement('div');
            div.className = type === 'error' ? 'analyzer-error' : 'analyzer-info';
            var strong = document.createElement('strong');
            strong.textContent = title;
            div.appendChild(strong);
            div.appendChild(document.createTextNode(' ' + message));
            container.textContent = '';
            container.appendChild(div);
        }

        function buildDetailCard(entry) {
            var m = entry.mapping;
            var badgeLabel = m.type === 'annotation' ? 'Annotation' : m.type === 'configmap' ? 'ConfigMap' : m.type.charAt(0).toUpperCase() + m.type.slice(1) + ' CRD';
            var card = document.createElement('div');
            card.className = 'analyzer-card type-' + m.type;
            var header = document.createElement('div');
            header.className = 'analyzer-card-header';
            var foundDiv = document.createElement('div');
            foundDiv.className = 'found-annotations';
            entry.foundAnnotations.forEach(function(a) {
                var code = document.createElement('code');
                code.textContent = 'nginx.ingress.kubernetes.io/' + a.annotation;
                if (ANNOTATION_TIPS[a.annotation]) {
                    code.className = 'annotation-tooltip';
                    code.setAttribute('data-tip', ANNOTATION_TIPS[a.annotation]);
                    code.setAttribute('title', ANNOTATION_TIPS[a.annotation]);
                    code.setAttribute('tabindex', '0');
                }
                foundDiv.appendChild(code);
                if (a.value) {
                    var valSpan = document.createElement('span');
                    valSpan.className = 'annotation-value';
                    valSpan.textContent = '= ' + a.value;
                    foundDiv.appendChild(valSpan);
                    foundDiv.appendChild(document.createTextNode(' '));
                }
            });
            header.appendChild(foundDiv);
            var badge = document.createElement('span');
            badge.className = 'badge badge-' + m.type;
            badge.textContent = badgeLabel;
            header.appendChild(badge);
            if (m.plusRequired) {
                var plusSpan = document.createElement('span');
                plusSpan.className = 'plus-indicator';
                plusSpan.textContent = 'Plus Required';
                header.appendChild(plusSpan);
            }
            card.appendChild(header);
            var body = document.createElement('div');
            body.className = 'analyzer-card-body';
            var arrow = document.createElement('span');
            arrow.className = 'migration-arrow';
            arrow.textContent = '\u2192';
            body.appendChild(arrow);
            body.appendChild(document.createTextNode(' ' + m.official));
            if (m.dualApproach) {
                var em = document.createElement('em');
                em.textContent = ' (dual approach: annotation or CRD)';
                body.appendChild(em);
            }
            card.appendChild(body);
            var footer = document.createElement('div');
            footer.className = 'analyzer-card-footer';
            var catLabel = document.createElement('span');
            catLabel.className = 'category-label';
            catLabel.textContent = m.category + ' (' + (m.section === 'oss' ? 'OSS' : 'Plus') + ')';
            footer.appendChild(catLabel);
            var link = document.createElement('a');
            link.href = '#' + m.anchor;
            link.textContent = 'View full migration example \u2192';
            link.addEventListener('click', function(e) {
                e.preventDefault();
                highlightSection(m.anchor);
            });
            footer.appendChild(link);
            card.appendChild(footer);
            return card;
        }

        function highlightYaml(text) {
            var frag = document.createDocumentFragment();
            var lines = text.split('\n');
            lines.forEach(function(line, i) {
                if (i > 0) frag.appendChild(document.createTextNode('\n'));
                // Comment lines
                var trimmed = line.trimStart();
                if (trimmed.startsWith('#')) {
                    var indent = document.createTextNode(line.substring(0, line.length - trimmed.length));
                    frag.appendChild(indent);
                    var commentSpan = document.createElement('span');
                    commentSpan.className = 'yaml-comment';
                    commentSpan.textContent = trimmed;
                    frag.appendChild(commentSpan);
                    return;
                }
                // Document separator
                if (trimmed === '---') {
                    var sepSpan = document.createElement('span');
                    sepSpan.className = 'yaml-separator';
                    sepSpan.textContent = line;
                    frag.appendChild(sepSpan);
                    return;
                }
                // Key: value pairs
                var kvMatch = line.match(/^(\s*)([-]?\s*)([^:#\n]+?)(\s*:\s*)(.*)?$/);
                if (kvMatch) {
                    frag.appendChild(document.createTextNode(kvMatch[1]));
                    if (kvMatch[2]) frag.appendChild(document.createTextNode(kvMatch[2]));
                    var keySpan = document.createElement('span');
                    keySpan.className = 'yaml-key';
                    keySpan.textContent = kvMatch[3];
                    frag.appendChild(keySpan);
                    var colonSpan = document.createElement('span');
                    colonSpan.className = 'yaml-separator';
                    colonSpan.textContent = kvMatch[4];
                    frag.appendChild(colonSpan);
                    if (kvMatch[5] !== undefined && kvMatch[5] !== '') {
                        var val = kvMatch[5];
                        var valSpan = document.createElement('span');
                        // Color-code specific value types
                        if (/^(apiVersion|kind|metadata|spec|data)$/.test(kvMatch[3].trim())) {
                            keySpan.className = 'yaml-keyword';
                        }
                        if (/^["']?(true|false|yes|no|on|off)["']?$/i.test(val.trim())) {
                            valSpan.className = 'yaml-bool';
                        } else if (/^["']?\d+(\.\d+)?[smhkMG]?["']?$/.test(val.trim())) {
                            valSpan.className = 'yaml-number';
                        } else if (val.trim().startsWith('#')) {
                            valSpan.className = 'yaml-comment';
                        } else {
                            valSpan.className = 'yaml-value';
                        }
                        valSpan.textContent = val;
                        frag.appendChild(valSpan);
                    }
                    return;
                }
                // List items (- value)
                var listMatch = line.match(/^(\s*)(- )(.*)$/);
                if (listMatch) {
                    frag.appendChild(document.createTextNode(listMatch[1]));
                    var dashSpan = document.createElement('span');
                    dashSpan.className = 'yaml-separator';
                    dashSpan.textContent = listMatch[2];
                    frag.appendChild(dashSpan);
                    var itemSpan = document.createElement('span');
                    itemSpan.className = 'yaml-value';
                    itemSpan.textContent = listMatch[3];
                    frag.appendChild(itemSpan);
                    return;
                }
                // Fallback
                frag.appendChild(document.createTextNode(line));
            });
            return frag;
        }

        function buildYamlBlock(text, collapsible) {
            var pre = document.createElement('div');
            pre.className = 'analyzer-yaml-output';
            var copyBtn = document.createElement('button');
            copyBtn.className = 'analyzer-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() { copyAnalyzerBlock(copyBtn); });
            pre.appendChild(copyBtn);
            pre.appendChild(highlightYaml(text));
            pre.setAttribute('data-raw', text);
            var lineCount = text.split('\n').length;
            if (collapsible && lineCount > 12) {
                pre.classList.add('collapsed');
                var wrapper = document.createDocumentFragment();
                wrapper.appendChild(pre);
                var expandBtn = document.createElement('button');
                expandBtn.className = 'analyzer-yaml-expand';
                expandBtn.textContent = 'Show full YAML (' + lineCount + ' lines)';
                expandBtn.addEventListener('click', function() {
                    if (pre.classList.contains('collapsed')) {
                        pre.classList.remove('collapsed');
                        expandBtn.textContent = 'Collapse';
                    } else {
                        pre.classList.add('collapsed');
                        expandBtn.textContent = 'Show full YAML (' + lineCount + ' lines)';
                    }
                });
                wrapper.appendChild(expandBtn);
                return wrapper;
            }
            return pre;
        }

        function buildDiffYamlBlock(text, diffType) {
            // diffType: 'removed' or 'added' — highlights annotation lines (skips the first 'annotations:' line)
            var pre = document.createElement('div');
            pre.className = 'analyzer-yaml-output';
            var copyBtn = document.createElement('button');
            copyBtn.className = 'analyzer-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() { copyAnalyzerBlock(copyBtn); });
            pre.appendChild(copyBtn);
            var lines = text.split('\n');
            lines.forEach(function(line, i) {
                if (i > 0) pre.appendChild(document.createTextNode('\n'));
                var isAnnotationLine = i > 0 && line.match(/^\s+\S/);
                if (isAnnotationLine) {
                    var wrapper = document.createElement('span');
                    wrapper.className = 'yaml-diff-line ' + diffType;
                    var frag = highlightYaml(line);
                    wrapper.appendChild(frag);
                    pre.appendChild(wrapper);
                } else {
                    pre.appendChild(highlightYaml(line));
                }
            });
            pre.setAttribute('data-raw', text);
            return pre;
        }

        function buildInstallBlock(installCmd) {
            var div = document.createElement('div');
            div.className = 'analyzer-install-cmd';
            div.setAttribute('data-raw', installCmd);
            var copyBtn = document.createElement('button');
            copyBtn.className = 'analyzer-copy-btn';
            copyBtn.textContent = 'Copy';
            copyBtn.addEventListener('click', function() { copyAnalyzerBlock(copyBtn); });
            div.appendChild(copyBtn);
            var code = document.createElement('span');
            code.textContent = installCmd;
            div.appendChild(code);
            return div;
        }

        function buildDetailsToggle(entries) {
            var btn = document.createElement('button');
            btn.className = 'analyzer-details-toggle';
            btn.textContent = 'Show details (' + entries.length + ' mapping' + (entries.length !== 1 ? 's' : '') + ')';
            btn.addEventListener('click', function() { toggleAnalyzerDetails(btn); });
            var container = document.createElement('div');
            container.className = 'analyzer-details-container';
            entries.forEach(function(e) {
                container.appendChild(buildDetailCard(e));
            });
            var wrapper = document.createDocumentFragment();
            wrapper.appendChild(btn);
            wrapper.appendChild(container);
            return wrapper;
        }

        function renderAnalyzerResults(container, totalAnnotations, sorted, crdCount, unrecognized) {
            container.textContent = '';
            var migration = generateMigrationYaml(sorted);

            // Summary pills
            var summary = document.createElement('div');
            summary.className = 'analyzer-summary';
            function addPill(cls, text, scrollTarget) {
                var span = document.createElement('span');
                span.className = 'analyzer-pill ' + cls;
                span.textContent = text;
                if (scrollTarget) {
                    span.setAttribute('data-scroll', scrollTarget);
                    span.setAttribute('title', 'Click to jump to this section');
                    span.addEventListener('click', function() {
                        var el = document.getElementById(scrollTarget);
                        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    });
                }
                summary.appendChild(span);
            }
            addPill('found', totalAnnotations + ' annotation' + (totalAnnotations !== 1 ? 's' : '') + ' found');
            addPill('paths', sorted.length + ' migration path' + (sorted.length !== 1 ? 's' : ''), migration.annotationSwaps.length > 0 ? 'analyzer-step-1' : null);
            if (crdCount > 0) addPill('crds', crdCount + ' require CRDs', 'analyzer-step-3');
            if (unrecognized.length > 0) addPill('unrecognized', unrecognized.length + ' unrecognized', 'analyzer-unrecognized');
            container.appendChild(summary);

            // Announce results to screen readers
            var liveStatus = document.getElementById('analyzerLiveStatus');
            if (liveStatus) {
                var msg = totalAnnotations + ' annotation' + (totalAnnotations !== 1 ? 's' : '') + ' found, ' + sorted.length + ' migration path' + (sorted.length !== 1 ? 's' : '');
                if (crdCount > 0) msg += ', ' + crdCount + ' require CRDs';
                if (unrecognized.length > 0) msg += ', ' + unrecognized.length + ' unrecognized';
                liveStatus.textContent = msg;
            }

            var animDelay = 0;
            function applyFadeIn(el) {
                el.classList.add('analyzer-fade-in');
                el.style.animationDelay = animDelay + 'ms';
                animDelay += 100;
            }
            applyFadeIn(summary);

            // Success banner
            var banner = document.createElement('div');
            banner.className = 'analyzer-success-banner';
            var svgNS = 'http://www.w3.org/2000/svg';
            var checkSvg = document.createElementNS(svgNS, 'svg');
            checkSvg.setAttribute('width', '22'); checkSvg.setAttribute('height', '22');
            checkSvg.setAttribute('viewBox', '0 0 24 24'); checkSvg.setAttribute('fill', 'none');
            checkSvg.setAttribute('stroke', 'currentColor'); checkSvg.setAttribute('stroke-width', '2.5');
            var checkPath = document.createElementNS(svgNS, 'path');
            checkPath.setAttribute('d', 'M22 11.08V12a10 10 0 1 1-5.93-9.14');
            var checkLine = document.createElementNS(svgNS, 'polyline');
            checkLine.setAttribute('points', '22 4 12 14.01 9 11.01');
            checkSvg.appendChild(checkPath); checkSvg.appendChild(checkLine);
            banner.appendChild(checkSvg);
            var bannerText = document.createElement('div');
            bannerText.className = 'banner-text';
            var stepCount = (migration.annotationSwaps.length > 0 ? 1 : 0) + (migration.configMapChanges.length > 0 ? 1 : 0) + (migration.crdResources.length > 0 ? 1 : 0);
            bannerText.textContent = 'Analysis complete \u2014 ';
            var bannerStrong = document.createElement('strong');
            bannerStrong.textContent = totalAnnotations + ' annotations analyzed';
            bannerText.appendChild(bannerStrong);
            bannerText.appendChild(document.createTextNode(', ' + sorted.length + ' migration paths across ' + stepCount + ' step' + (stepCount !== 1 ? 's' : '') + '.'));
            banner.appendChild(bannerText);

            // Complexity indicator
            var complexityLevel = crdCount > 0 ? 'advanced' : (migration.configMapChanges.length > 0 ? 'moderate' : 'simple');
            var complexityLabels = { simple: 'Simple Migration', moderate: 'Moderate Migration', advanced: 'Advanced Migration' };
            var complexityFilled = { simple: 1, moderate: 2, advanced: 3 };
            var complexBadge = document.createElement('span');
            complexBadge.className = 'analyzer-complexity ' + complexityLevel;
            var dotsDiv = document.createElement('span');
            dotsDiv.className = 'analyzer-complexity-dots';
            for (var ci = 0; ci < 3; ci++) {
                var dot = document.createElement('span');
                if (ci < complexityFilled[complexityLevel]) dot.className = 'filled';
                dotsDiv.appendChild(dot);
            }
            complexBadge.appendChild(dotsDiv);
            complexBadge.appendChild(document.createTextNode(complexityLabels[complexityLevel]));
            banner.appendChild(complexBadge);
            applyFadeIn(banner);
            container.appendChild(banner);

            var stepNum = 0;

            // Step 1: Annotation Swaps
            if (migration.annotationSwaps.length > 0) {
                stepNum++;
                var step1 = document.createElement('div');
                step1.className = 'analyzer-step';
                step1.id = 'analyzer-step-1';
                var h1 = document.createElement('div');
                h1.className = 'analyzer-step-header';
                var n1 = document.createElement('div');
                n1.className = 'analyzer-step-number';
                n1.textContent = String(stepNum);
                var t1 = document.createElement('div');
                t1.className = 'analyzer-step-title';
                t1.textContent = 'Swap Annotations';
                var c1 = document.createElement('span');
                c1.className = 'analyzer-step-count';
                c1.textContent = migration.annotationSwaps.length + ' annotation' + (migration.annotationSwaps.length !== 1 ? 's' : '');
                h1.appendChild(n1);
                h1.appendChild(t1);
                h1.appendChild(c1);
                step1.appendChild(h1);
                var d1 = document.createElement('div');
                d1.className = 'analyzer-step-desc';
                d1.textContent = 'Replace community annotations with their Official NGINX equivalents. Copy this annotations block into your Ingress metadata.';
                step1.appendChild(d1);

                var oldLines = ['annotations:'];
                var newLines = ['annotations:'];
                var seenEntries = new Map();
                // Sort by category for grouped output
                var swapsByCategory = {};
                migration.annotationSwaps.forEach(function(swap) {
                    var cat = swap.entry.mapping.category;
                    if (!swapsByCategory[cat]) swapsByCategory[cat] = [];
                    swapsByCategory[cat].push(swap);
                });
                var categoryKeys = Object.keys(swapsByCategory).sort();
                var multiCategory = categoryKeys.length > 1;
                categoryKeys.forEach(function(cat) {
                    if (multiCategory) {
                        oldLines.push('  # ' + cat);
                        newLines.push('  # ' + cat);
                    }
                    swapsByCategory[cat].forEach(function(swap) {
                        oldLines.push('  ' + swap.from + ': "' + (swap.originalValue || swap.value) + '"');
                        newLines.push('  ' + swap.to + ': "' + swap.value + '"');
                        if (!seenEntries.has(swap.entry)) seenEntries.set(swap.entry, swap.entry);
                    });
                });

                // Side-by-side comparison
                var comp = document.createElement('div');
                comp.className = 'analyzer-comparison';
                var oldBlock = document.createElement('div');
                oldBlock.className = 'analyzer-comparison-block old';
                var oldH5 = document.createElement('h5');
                oldH5.textContent = 'Community NGINX Ingress (current)';
                oldBlock.appendChild(oldH5);
                oldBlock.appendChild(buildDiffYamlBlock(oldLines.join('\n'), 'removed'));
                var newBlock = document.createElement('div');
                newBlock.className = 'analyzer-comparison-block new';
                var newH5 = document.createElement('h5');
                newH5.textContent = 'Official NGINX Ingress (migrated)';
                newBlock.appendChild(newH5);
                newBlock.appendChild(buildDiffYamlBlock(newLines.join('\n'), 'added'));
                comp.appendChild(oldBlock);
                comp.appendChild(newBlock);
                step1.appendChild(comp);

                // Dual-approach note
                var dualEntries = Array.from(seenEntries.values()).filter(function(e) { return e.mapping.dualApproach; });
                if (dualEntries.length > 0) {
                    var dualNote = document.createElement('div');
                    dualNote.className = 'analyzer-dual-note';
                    dualNote.textContent = 'Some annotations above also have a CRD-based approach shown in Step ' + (migration.crdResources.length > 0 ? '3' : 'N/A') + ' below.';
                    step1.appendChild(dualNote);
                }

                step1.appendChild(buildDetailsToggle(Array.from(seenEntries.values())));
                applyFadeIn(step1);
                container.appendChild(step1);
            }

            // Step 2: ConfigMap Changes
            if (migration.configMapChanges.length > 0) {
                stepNum++;
                var step2 = document.createElement('div');
                step2.className = 'analyzer-step';
                step2.id = 'analyzer-step-2';
                var h2 = document.createElement('div');
                h2.className = 'analyzer-step-header';
                var n2 = document.createElement('div');
                n2.className = 'analyzer-step-number';
                n2.textContent = String(stepNum);
                var t2 = document.createElement('div');
                t2.className = 'analyzer-step-title';
                t2.textContent = 'ConfigMap Changes';
                var c2 = document.createElement('span');
                c2.className = 'analyzer-step-count configmap';
                c2.textContent = migration.configMapChanges.length + ' entr' + (migration.configMapChanges.length !== 1 ? 'ies' : 'y');
                h2.appendChild(n2);
                h2.appendChild(t2);
                h2.appendChild(c2);
                step2.appendChild(h2);
                var d2 = document.createElement('div');
                d2.className = 'analyzer-step-desc';
                d2.textContent = 'These settings are configured via the NGINX ConfigMap instead of annotations. Update your nginx-config ConfigMap with these entries.';
                step2.appendChild(d2);

                var cmOldLines = ['# Annotations to remove:'];
                var cmLines = ['apiVersion: v1', 'kind: ConfigMap', 'metadata:', '  name: nginx-config', 'data:'];
                var cmEntries = new Map();
                migration.configMapChanges.forEach(function(change) {
                    cmOldLines.push(change.from + ': "' + (change.originalValue || change.value) + '"');
                    cmLines.push('  ' + change.to + ': "' + change.value + '"');
                    if (!cmEntries.has(change.entry)) cmEntries.set(change.entry, change.entry);
                });

                // Side-by-side comparison for ConfigMap
                var cmComp = document.createElement('div');
                cmComp.className = 'analyzer-comparison';
                var cmOldBlock = document.createElement('div');
                cmOldBlock.className = 'analyzer-comparison-block old';
                var cmOldH5 = document.createElement('h5');
                cmOldH5.textContent = 'Annotations (remove these)';
                cmOldBlock.appendChild(cmOldH5);
                cmOldBlock.appendChild(buildDiffYamlBlock(cmOldLines.join('\n'), 'removed'));
                var cmNewBlock = document.createElement('div');
                cmNewBlock.className = 'analyzer-comparison-block new';
                var cmNewH5 = document.createElement('h5');
                cmNewH5.textContent = 'ConfigMap entries (add these)';
                cmNewBlock.appendChild(cmNewH5);
                cmNewBlock.appendChild(buildYamlBlock(cmLines.join('\n')));
                cmComp.appendChild(cmOldBlock);
                cmComp.appendChild(cmNewBlock);
                step2.appendChild(cmComp);
                step2.appendChild(buildDetailsToggle(Array.from(cmEntries.values())));
                applyFadeIn(step2);
                container.appendChild(step2);
            }

            // Step 3: CRD Resources
            if (migration.crdResources.length > 0) {
                stepNum++;
                var step3 = document.createElement('div');
                step3.className = 'analyzer-step';
                step3.id = 'analyzer-step-3';
                var h3 = document.createElement('div');
                h3.className = 'analyzer-step-header';
                var n3 = document.createElement('div');
                n3.className = 'analyzer-step-number';
                n3.textContent = String(stepNum);
                var t3 = document.createElement('div');
                t3.className = 'analyzer-step-title';
                t3.textContent = 'CRD Resources';
                var c3 = document.createElement('span');
                c3.className = 'analyzer-step-count crd';
                c3.textContent = migration.crdResources.length + ' resource' + (migration.crdResources.length !== 1 ? 's' : '');
                h3.appendChild(n3);
                h3.appendChild(t3);
                h3.appendChild(c3);
                step3.appendChild(h3);
                var d3 = document.createElement('div');
                d3.className = 'analyzer-step-desc';
                d3.textContent = 'These features require Custom Resource Definitions. Install the CRDs first, then apply the generated resources.';
                step3.appendChild(d3);

                // Group by CRD kind
                var crdGroups = {};
                migration.crdResources.forEach(function(res) {
                    if (!crdGroups[res.kind]) crdGroups[res.kind] = [];
                    crdGroups[res.kind].push(res);
                });

                // Deduplicate install commands across all groups
                var seenInstalls = new Set();
                var allInstalls = [];
                Object.keys(crdGroups).forEach(function(kind) {
                    crdGroups[kind].forEach(function(res) {
                        if (res.install && !seenInstalls.has(res.install)) {
                            seenInstalls.add(res.install);
                            allInstalls.push(res.install);
                        }
                    });
                });
                if (allInstalls.length > 0) {
                    var installLabel = document.createElement('div');
                    installLabel.style.cssText = 'font-size:0.85rem;font-weight:600;color:#666;margin-bottom:4px;';
                    installLabel.textContent = 'Install required CRDs:';
                    step3.appendChild(installLabel);
                    step3.appendChild(buildInstallBlock(allInstalls.join('\n')));
                }

                Object.keys(crdGroups).forEach(function(kind) {
                    var group = crdGroups[kind];
                    var groupDiv = document.createElement('div');
                    groupDiv.className = 'analyzer-crd-group';
                    var groupTitle = document.createElement('div');
                    groupTitle.className = 'analyzer-crd-group-title';
                    // Map CRD kind to badge class
                    var kindBadgeMap = { 'Policy': 'policy', 'VirtualServer': 'virtualserver', 'VirtualServerRoute': 'virtualserverroute', 'TransportServer': 'transportserver', 'GlobalConfiguration': 'globalconfiguration' };
                    var badgeClass = kindBadgeMap[kind] || 'virtualserver';
                    var kindBadge = document.createElement('span');
                    kindBadge.className = 'badge badge-' + badgeClass;
                    kindBadge.style.marginRight = '8px';
                    kindBadge.textContent = kind + ' CRD';
                    groupTitle.appendChild(kindBadge);
                    groupTitle.appendChild(document.createTextNode(group.length + ' resource' + (group.length !== 1 ? 's' : '')));
                    groupDiv.appendChild(groupTitle);

                    group.forEach(function(res, idx) {
                        if (idx > 0) {
                            var spacer = document.createElement('hr');
                            spacer.className = 'analyzer-step-separator';
                            groupDiv.appendChild(spacer);
                        }
                        var catLabel = document.createElement('div');
                        catLabel.style.cssText = 'font-size:0.82rem;color:#888;margin-bottom:4px;';
                        catLabel.textContent = res.entry.mapping.category;
                        if (res.entry.mapping.plusRequired) catLabel.textContent += ' (Plus Required)';
                        if (res.entry.mapping.dualApproach) catLabel.textContent += ' — CRD Approach';
                        groupDiv.appendChild(catLabel);
                        groupDiv.appendChild(buildYamlBlock(res.yaml, true));
                    });

                    var crdEntries = group.map(function(r) { return r.entry; });
                    groupDiv.appendChild(buildDetailsToggle(crdEntries));
                    step3.appendChild(groupDiv);
                });

                applyFadeIn(step3);
                container.appendChild(step3);
            }

            // Unrecognized
            if (unrecognized.length > 0) {
                var unrecSection = document.createElement('div');
                unrecSection.className = 'analyzer-unrecognized-section';
                unrecSection.id = 'analyzer-unrecognized';
                var h4 = document.createElement('h4');
                h4.textContent = 'Unrecognized Annotations';
                unrecSection.appendChild(h4);
                var desc = document.createElement('p');
                desc.style.fontSize = '0.9rem';
                desc.style.color = '#666';
                desc.style.marginBottom = '10px';
                desc.textContent = 'These annotations were not found in the migration database. They may be custom, deprecated, or not yet mapped.';
                unrecSection.appendChild(desc);
                unrecognized.forEach(function(u) {
                    var uCard = document.createElement('div');
                    uCard.className = 'analyzer-card unrecognized';
                    var uHeader = document.createElement('div');
                    uHeader.className = 'analyzer-card-header';
                    var uFound = document.createElement('div');
                    uFound.className = 'found-annotations';
                    var uCode = document.createElement('code');
                    uCode.textContent = 'nginx.ingress.kubernetes.io/' + u.annotation;
                    if (ANNOTATION_TIPS[u.annotation]) {
                        uCode.className = 'annotation-tooltip';
                        uCode.setAttribute('data-tip', ANNOTATION_TIPS[u.annotation]);
                        uCode.setAttribute('title', ANNOTATION_TIPS[u.annotation]);
                        uCode.setAttribute('tabindex', '0');
                    }
                    uFound.appendChild(uCode);
                    if (u.value) {
                        var uVal = document.createElement('span');
                        uVal.className = 'annotation-value';
                        uVal.textContent = '= ' + u.value;
                        uFound.appendChild(uVal);
                    }
                    uHeader.appendChild(uFound);
                    uCard.appendChild(uHeader);
                    unrecSection.appendChild(uCard);
                });
                var contributeP = document.createElement('p');
                contributeP.style.fontSize = '0.85rem';
                contributeP.style.marginTop = '10px';
                var contributeLink = document.createElement('a');
                contributeLink.href = 'https://github.com/alessfg/nginx-ingress-migration-guide';
                contributeLink.target = '_blank';
                contributeLink.style.color = 'var(--primary-color)';
                contributeLink.textContent = 'Contribute a mapping on GitHub \u2192';
                contributeP.appendChild(contributeLink);
                unrecSection.appendChild(contributeP);
                applyFadeIn(unrecSection);
                container.appendChild(unrecSection);
            }

            // Export actions (Copy All + Download)
            if (migration.annotationSwaps.length > 0 || migration.configMapChanges.length > 0 || migration.crdResources.length > 0) {
                var allYamlParts = [];
                if (migration.annotationSwaps.length > 0) {
                    var swapLines = ['# Step 1: Annotation Swaps', 'annotations:'];
                    var copySwapsByCat = {};
                    migration.annotationSwaps.forEach(function(s) {
                        var cat = s.entry.mapping.category;
                        if (!copySwapsByCat[cat]) copySwapsByCat[cat] = [];
                        copySwapsByCat[cat].push(s);
                    });
                    var copyCatKeys = Object.keys(copySwapsByCat).sort();
                    copyCatKeys.forEach(function(cat) {
                        if (copyCatKeys.length > 1) swapLines.push('  # ' + cat);
                        copySwapsByCat[cat].forEach(function(s) { swapLines.push('  ' + s.to + ': "' + s.value + '"'); });
                    });
                    allYamlParts.push(swapLines.join('\n'));
                }
                if (migration.configMapChanges.length > 0) {
                    var cmParts = ['# Step 2: ConfigMap Changes', 'apiVersion: v1', 'kind: ConfigMap', 'metadata:', '  name: nginx-config', 'data:'];
                    migration.configMapChanges.forEach(function(c) { cmParts.push('  ' + c.to + ': "' + c.value + '"'); });
                    allYamlParts.push(cmParts.join('\n'));
                }
                if (migration.crdResources.length > 0) {
                    migration.crdResources.forEach(function(r) {
                        allYamlParts.push('# Step 3: ' + r.entry.mapping.category + ' (' + r.kind + ')\n' + r.yaml);
                    });
                }
                var allYaml = allYamlParts.join('\n---\n');
                var exportRow = document.createElement('div');
                exportRow.className = 'analyzer-export-actions';
                var copyAllBtn = document.createElement('button');
                copyAllBtn.className = 'analyzer-copy-all';
                copyAllBtn.style.marginTop = '0';
                var svgNS = 'http://www.w3.org/2000/svg';
                var clipSvg = document.createElementNS(svgNS, 'svg');
                clipSvg.setAttribute('width', '18');
                clipSvg.setAttribute('height', '18');
                clipSvg.setAttribute('viewBox', '0 0 24 24');
                clipSvg.setAttribute('fill', 'none');
                clipSvg.setAttribute('stroke', 'currentColor');
                clipSvg.setAttribute('stroke-width', '2');
                var rect1 = document.createElementNS(svgNS, 'rect');
                rect1.setAttribute('x', '9'); rect1.setAttribute('y', '9');
                rect1.setAttribute('width', '13'); rect1.setAttribute('height', '13');
                rect1.setAttribute('rx', '2'); rect1.setAttribute('ry', '2');
                var path1 = document.createElementNS(svgNS, 'path');
                path1.setAttribute('d', 'M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1');
                clipSvg.appendChild(rect1);
                clipSvg.appendChild(path1);
                copyAllBtn.appendChild(clipSvg);
                copyAllBtn.appendChild(document.createTextNode('Copy All Migration YAML'));
                copyAllBtn.addEventListener('click', function() {
                    function onCopied() {
                        copyAllBtn.textContent = '';
                        copyAllBtn.appendChild(clipSvg);
                        copyAllBtn.appendChild(document.createTextNode('Copied!'));
                        copyAllBtn.classList.add('copied');
                        setTimeout(function() {
                            copyAllBtn.textContent = '';
                            copyAllBtn.appendChild(clipSvg);
                            copyAllBtn.appendChild(document.createTextNode('Copy All Migration YAML'));
                            copyAllBtn.classList.remove('copied');
                        }, 2000);
                    }
                    if (navigator.clipboard && navigator.clipboard.writeText) {
                        navigator.clipboard.writeText(allYaml).then(onCopied).catch(function() {
                            fallbackCopy(allYaml);
                            onCopied();
                        });
                    } else {
                        fallbackCopy(allYaml);
                        onCopied();
                    }
                });
                exportRow.appendChild(copyAllBtn);

                // Download YAML button
                var dlBtn = document.createElement('button');
                dlBtn.className = 'analyzer-download-btn';
                var dlSvg = document.createElementNS(svgNS, 'svg');
                dlSvg.setAttribute('width', '18'); dlSvg.setAttribute('height', '18');
                dlSvg.setAttribute('viewBox', '0 0 24 24'); dlSvg.setAttribute('fill', 'none');
                dlSvg.setAttribute('stroke', 'currentColor'); dlSvg.setAttribute('stroke-width', '2');
                var dlPath1 = document.createElementNS(svgNS, 'path');
                dlPath1.setAttribute('d', 'M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4');
                var dlPath2 = document.createElementNS(svgNS, 'polyline');
                dlPath2.setAttribute('points', '7 10 12 15 17 10');
                var dlPath3 = document.createElementNS(svgNS, 'line');
                dlPath3.setAttribute('x1', '12'); dlPath3.setAttribute('y1', '15');
                dlPath3.setAttribute('x2', '12'); dlPath3.setAttribute('y2', '3');
                dlSvg.appendChild(dlPath1); dlSvg.appendChild(dlPath2); dlSvg.appendChild(dlPath3);
                dlBtn.appendChild(dlSvg);
                dlBtn.appendChild(document.createTextNode('Download YAML'));
                dlBtn.addEventListener('click', function() {
                    var header = '# NGINX Ingress Migration Guide — Generated Output\n# https://alessfg.github.io/nginx-ingress-migration-guide/\n# Generated: ' + new Date().toISOString().split('T')[0] + '\n\n';
                    var blob = new Blob([header + allYaml], { type: 'application/x-yaml' });
                    var url = URL.createObjectURL(blob);
                    var a = document.createElement('a');
                    a.href = url;
                    a.download = 'nginx-ingress-migration.yaml';
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    dlBtn.classList.add('downloaded');
                    var origText = dlBtn.lastChild;
                    origText.textContent = 'Downloaded!';
                    setTimeout(function() {
                        origText.textContent = 'Download YAML';
                        dlBtn.classList.remove('downloaded');
                    }, 2000);
                });
                exportRow.appendChild(dlBtn);
                container.appendChild(exportRow);
            }

            updateNavBadge(totalAnnotations);

            // What's Next? section
            if (sorted.length > 0) {
                var nextBox = document.createElement('div');
                nextBox.className = 'analyzer-next-steps';
                var nextH4 = document.createElement('h4');
                nextH4.textContent = "What's Next?";
                nextBox.appendChild(nextH4);
                var nextUl = document.createElement('ul');
                var nextItems = [
                    { text: 'Review the full Migration Checklist', anchor: '#checklist' },
                    { text: 'Browse all OSS annotation mappings', anchor: '#oss-mappings' }
                ];
                if (crdCount > 0) nextItems.push({ text: 'Install the required CRDs', anchor: '#installation' });
                nextItems.push({ text: 'Check the Official NGINX Ingress Controller docs', href: 'https://docs.nginx.com/nginx-ingress-controller/', external: true });
                nextItems.forEach(function(item) {
                    var li = document.createElement('li');
                    var a = document.createElement('a');
                    if (item.external) {
                        a.href = item.href;
                        a.target = '_blank';
                        a.rel = 'noopener noreferrer';
                    } else {
                        a.href = item.anchor;
                        a.addEventListener('click', function(e) {
                            e.preventDefault();
                            highlightSection(item.anchor.replace('#', ''));
                        });
                    }
                    a.textContent = item.text;
                    li.appendChild(a);
                    nextUl.appendChild(li);
                });
                nextBox.appendChild(nextUl);
                container.appendChild(nextBox);

                // Edit YAML button
                var editBtn = document.createElement('button');
                editBtn.className = 'analyzer-edit-btn';
                var editSvgNS = 'http://www.w3.org/2000/svg';
                var editSvg = document.createElementNS(editSvgNS, 'svg');
                editSvg.setAttribute('width', '16'); editSvg.setAttribute('height', '16');
                editSvg.setAttribute('viewBox', '0 0 24 24'); editSvg.setAttribute('fill', 'none');
                editSvg.setAttribute('stroke', 'currentColor'); editSvg.setAttribute('stroke-width', '2');
                var editPath = document.createElementNS(editSvgNS, 'path');
                editPath.setAttribute('d', 'M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7');
                var editPath2 = document.createElementNS(editSvgNS, 'path');
                editPath2.setAttribute('d', 'M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z');
                editSvg.appendChild(editPath); editSvg.appendChild(editPath2);
                editBtn.appendChild(editSvg);
                editBtn.appendChild(document.createTextNode('Edit YAML & Re-Analyze'));
                editBtn.addEventListener('click', function() {
                    var textarea = document.getElementById('yamlInput');
                    textarea.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    setTimeout(function() { textarea.focus(); }, 400);
                });
                container.appendChild(editBtn);
            }
        }

        function updateNavBadge(count) {
            var navLink = document.querySelector('nav a[href="#analyzer"]');
            if (!navLink) return;
            var existing = navLink.querySelector('.nav-badge');
            if (existing) navLink.removeChild(existing);
            if (count > 0) {
                var badge = document.createElement('span');
                badge.className = 'nav-badge';
                badge.textContent = String(count);
                navLink.appendChild(badge);
            }
        }

        function clearAnalyzer() {
            document.getElementById('yamlInput').value = '';
            document.getElementById('analyzerResults').textContent = '';
            showEmptyState();
            updateInputStatus();
            updateNavBadge(0);
        }

        // Sample YAML presets
        var SAMPLE_PRESETS = {
            simple:
'apiVersion: networking.k8s.io/v1\n' +
'kind: Ingress\n' +
'metadata:\n' +
'  name: simple-app\n' +
'  annotations:\n' +
'    nginx.ingress.kubernetes.io/ssl-redirect: "true"\n' +
'    nginx.ingress.kubernetes.io/proxy-body-size: "10m"\n' +
'    nginx.ingress.kubernetes.io/proxy-connect-timeout: "30"\n' +
'    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"\n' +
'    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"\n' +
'spec:\n' +
'  ingressClassName: nginx\n' +
'  tls:\n' +
'    - hosts:\n' +
'        - app.example.com\n' +
'      secretName: app-tls\n' +
'  rules:\n' +
'    - host: app.example.com\n' +
'      http:\n' +
'        paths:\n' +
'          - path: /\n' +
'            pathType: Prefix\n' +
'            backend:\n' +
'              service:\n' +
'                name: app-service\n' +
'                port:\n' +
'                  number: 80',
            moderate:
'apiVersion: networking.k8s.io/v1\n' +
'kind: Ingress\n' +
'metadata:\n' +
'  name: production-app\n' +
'  annotations:\n' +
'    nginx.ingress.kubernetes.io/rewrite-target: /$2\n' +
'    nginx.ingress.kubernetes.io/use-regex: "true"\n' +
'    nginx.ingress.kubernetes.io/ssl-redirect: "true"\n' +
'    nginx.ingress.kubernetes.io/proxy-body-size: "50m"\n' +
'    nginx.ingress.kubernetes.io/proxy-buffer-size: "8k"\n' +
'    nginx.ingress.kubernetes.io/proxy-connect-timeout: "30"\n' +
'    nginx.ingress.kubernetes.io/proxy-read-timeout: "120"\n' +
'    nginx.ingress.kubernetes.io/proxy-send-timeout: "120"\n' +
'    nginx.ingress.kubernetes.io/limit-rps: "20"\n' +
'    nginx.ingress.kubernetes.io/limit-burst-multiplier: "5"\n' +
'    nginx.ingress.kubernetes.io/whitelist-source-range: "10.0.0.0/8,172.16.0.0/12"\n' +
'    nginx.ingress.kubernetes.io/enable-cors: "true"\n' +
'    nginx.ingress.kubernetes.io/cors-allow-origin: "https://app.example.com"\n' +
'    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE"\n' +
'    nginx.ingress.kubernetes.io/server-tokens: "false"\n' +
'    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"\n' +
'spec:\n' +
'  ingressClassName: nginx\n' +
'  tls:\n' +
'    - hosts:\n' +
'        - app.example.com\n' +
'      secretName: app-tls\n' +
'  rules:\n' +
'    - host: app.example.com\n' +
'      http:\n' +
'        paths:\n' +
'          - path: /api(/|$)(.*)\n' +
'            pathType: ImplementationSpecific\n' +
'            backend:\n' +
'              service:\n' +
'                name: api-service\n' +
'                port:\n' +
'                  number: 443',
            advanced:
'apiVersion: networking.k8s.io/v1\n' +
'kind: Ingress\n' +
'metadata:\n' +
'  name: enterprise-app\n' +
'  annotations:\n' +
'    # SSL and security\n' +
'    nginx.ingress.kubernetes.io/ssl-redirect: "true"\n' +
'    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"\n' +
'    nginx.ingress.kubernetes.io/auth-tls-verify-client: "on"\n' +
'    nginx.ingress.kubernetes.io/auth-tls-secret: "default/ca-secret"\n' +
'    nginx.ingress.kubernetes.io/auth-tls-verify-depth: "2"\n' +
'    # Session affinity (Plus)\n' +
'    nginx.ingress.kubernetes.io/affinity: "cookie"\n' +
'    nginx.ingress.kubernetes.io/session-cookie-name: "SERVERID"\n' +
'    nginx.ingress.kubernetes.io/session-cookie-expires: "172800"\n' +
'    nginx.ingress.kubernetes.io/session-cookie-max-age: "172800"\n' +
'    nginx.ingress.kubernetes.io/session-cookie-path: "/"\n' +
'    # WAF/ModSecurity (Plus)\n' +
'    nginx.ingress.kubernetes.io/enable-modsecurity: "true"\n' +
'    nginx.ingress.kubernetes.io/modsecurity-snippet: |\n' +
'      SecRuleEngine On\n' +
'      SecRule ARGS "@contains <script>" "id:1,deny,status:403"\n' +
'    # Rate limiting\n' +
'    nginx.ingress.kubernetes.io/limit-rps: "100"\n' +
'    nginx.ingress.kubernetes.io/limit-connections: "50"\n' +
'    # Proxy settings\n' +
'    nginx.ingress.kubernetes.io/proxy-body-size: "100m"\n' +
'    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"\n' +
'    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"\n' +
'    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"\n' +
'    # CORS\n' +
'    nginx.ingress.kubernetes.io/enable-cors: "true"\n' +
'    nginx.ingress.kubernetes.io/cors-allow-origin: "*"\n' +
'    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS"\n' +
'    nginx.ingress.kubernetes.io/cors-allow-headers: "Authorization, Content-Type, X-Request-ID"\n' +
'spec:\n' +
'  ingressClassName: nginx\n' +
'  tls:\n' +
'    - hosts:\n' +
'        - secure.example.com\n' +
'      secretName: enterprise-tls\n' +
'  rules:\n' +
'    - host: secure.example.com\n' +
'      http:\n' +
'        paths:\n' +
'          - path: /\n' +
'            pathType: Prefix\n' +
'            backend:\n' +
'              service:\n' +
'                name: enterprise-service\n' +
'                port:\n' +
'                  number: 443'
        };

        function toggleSampleDropdown(e) {
            e.stopPropagation();
            var dropdown = document.getElementById('sampleDropdown');
            var btn = e.target.closest('.sample-dropdown-btn');
            var isVisible = dropdown.classList.toggle('visible');
            if (btn) btn.setAttribute('aria-expanded', isVisible ? 'true' : 'false');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', function(e) {
            var dropdown = document.getElementById('sampleDropdown');
            var btn = document.querySelector('.sample-dropdown-btn');
            if (dropdown && !e.target.closest('.sample-dropdown')) {
                dropdown.classList.remove('visible');
                if (btn) btn.setAttribute('aria-expanded', 'false');
            }
        });

        function loadSampleYaml(preset) {
            var yaml = SAMPLE_PRESETS[preset] || SAMPLE_PRESETS.moderate;
            document.getElementById('yamlInput').value = yaml;
            document.getElementById('analyzerResults').textContent = '';
            document.getElementById('sampleDropdown').classList.remove('visible');
            var btn = document.querySelector('.sample-dropdown-btn');
            if (btn) btn.setAttribute('aria-expanded', 'false');
            updateInputStatus();
        }

        function highlightSection(anchorId) {
            var el = document.getElementById(anchorId);
            if (!el) return;
            el.scrollIntoView({ behavior: 'smooth' });
            el.style.transition = 'background-color 0.3s';
            el.style.backgroundColor = '#fff9c4';
            setTimeout(function() {
                el.style.backgroundColor = '';
                setTimeout(function() { el.style.transition = ''; }, 300);
            }, 2000);
        }

        function showEmptyState() {
            var resultsDiv = document.getElementById('analyzerResults');
            if (resultsDiv.children.length > 0) return;
            var empty = document.createElement('div');
            empty.className = 'analyzer-empty-state';
            empty.id = 'analyzerEmptyState';
            var svgNS = 'http://www.w3.org/2000/svg';
            var svg = document.createElementNS(svgNS, 'svg');
            svg.setAttribute('width', '48'); svg.setAttribute('height', '48');
            svg.setAttribute('viewBox', '0 0 24 24'); svg.setAttribute('fill', 'none');
            svg.setAttribute('stroke', '#999'); svg.setAttribute('stroke-width', '1.5');
            var path1 = document.createElementNS(svgNS, 'path');
            path1.setAttribute('d', 'M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z');
            var polyline = document.createElementNS(svgNS, 'polyline');
            polyline.setAttribute('points', '14 2 14 8 20 8');
            var line1 = document.createElementNS(svgNS, 'line');
            line1.setAttribute('x1', '16'); line1.setAttribute('y1', '13');
            line1.setAttribute('x2', '8'); line1.setAttribute('y2', '13');
            var line2 = document.createElementNS(svgNS, 'line');
            line2.setAttribute('x1', '16'); line2.setAttribute('y1', '17');
            line2.setAttribute('x2', '8'); line2.setAttribute('y2', '17');
            svg.appendChild(path1); svg.appendChild(polyline);
            svg.appendChild(line1); svg.appendChild(line2);
            empty.appendChild(svg);
            var p1 = document.createElement('p');
            p1.textContent = 'Paste your Ingress YAML above and click Analyze';
            empty.appendChild(p1);
            var p2 = document.createElement('p');
            p2.className = 'hint';
            p2.textContent = 'Drag & drop a .yaml file, or try "Load Sample" for an example';
            empty.appendChild(p2);
            resultsDiv.appendChild(empty);
        }

        // Drag-and-drop file upload
        (function() {
            var dropZone = document.getElementById('dropZone');
            var textarea = document.getElementById('yamlInput');
            var dragCounter = 0;
            dropZone.addEventListener('dragenter', function(e) {
                e.preventDefault();
                dragCounter++;
                dropZone.classList.add('dragging');
            });
            dropZone.addEventListener('dragleave', function(e) {
                e.preventDefault();
                dragCounter--;
                if (dragCounter <= 0) { dragCounter = 0; dropZone.classList.remove('dragging'); }
            });
            dropZone.addEventListener('dragover', function(e) { e.preventDefault(); });
            dropZone.addEventListener('drop', function(e) {
                e.preventDefault();
                dragCounter = 0;
                dropZone.classList.remove('dragging');
                var files = e.dataTransfer.files;
                if (files.length > 0) {
                    var file = files[0];
                    if (file.name.match(/\.(ya?ml|txt)$/i) || file.type === 'text/plain' || file.type === 'application/x-yaml') {
                        var reader = new FileReader();
                        reader.onload = function(ev) {
                            textarea.value = ev.target.result;
                            updateInputStatus();
                            document.getElementById('analyzerResults').textContent = '';
                        };
                        reader.readAsText(file);
                    }
                }
            });
        })();

        // Live input status
        function updateInputStatus() {
            var val = document.getElementById('yamlInput').value;
            var lineCount = val ? val.split('\n').length : 0;
            var annotationCount = (val.match(/nginx\.ingress\.kubernetes\.io\//g) || []).length;
            document.getElementById('statusLines').textContent = lineCount + ' line' + (lineCount !== 1 ? 's' : '');
            document.getElementById('statusDot').className = 'status-dot ' + (lineCount > 0 ? 'active' : 'inactive');
            var annStatus = document.getElementById('statusAnnotations');
            if (annotationCount > 0) {
                annStatus.style.display = '';
                document.getElementById('statusAnnotationCount').textContent = annotationCount + ' annotation' + (annotationCount !== 1 ? 's' : '') + ' detected';
            } else {
                annStatus.style.display = 'none';
            }
        }
        document.getElementById('yamlInput').addEventListener('input', updateInputStatus);

        // Keyboard shortcuts for textarea
        document.getElementById('yamlInput').addEventListener('keydown', function(e) {
            // Ctrl+Enter or Cmd+Enter to analyze
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                analyzeYaml();
                return;
            }
            // Tab inserts 2 spaces (Escape releases focus)
            if (e.key === 'Escape') {
                this.blur();
                return;
            }
            if (e.key === 'Tab') {
                e.preventDefault();
                var start = this.selectionStart;
                var end = this.selectionEnd;
                this.value = this.value.substring(0, start) + '  ' + this.value.substring(end);
                this.selectionStart = this.selectionEnd = start + 2;
                updateInputStatus();
            }
        });

        // Show empty state on page load
        showEmptyState();

        // Active nav highlighting on scroll
        (function() {
            var navLinks = document.querySelectorAll('nav a[href^="#"]');
            var sections = [];
            navLinks.forEach(function(link) {
                var id = link.getAttribute('href').replace('#', '');
                var section = document.getElementById(id);
                if (section) sections.push({ el: section, link: link });
            });
            if (sections.length === 0) return;
            var observer = new IntersectionObserver(function(entries) {
                entries.forEach(function(entry) {
                    var matchedLink = sections.find(function(s) { return s.el === entry.target; });
                    if (matchedLink) {
                        if (entry.isIntersecting) {
                            navLinks.forEach(function(l) { l.classList.remove('active'); });
                            matchedLink.link.classList.add('active');
                        }
                    }
                });
            }, { rootMargin: '-80px 0px -60% 0px', threshold: 0 });
            sections.forEach(function(s) { observer.observe(s.el); });
        })();

        // Dark mode toggle
        function toggleDarkMode() {
            var isDark = document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDark ? '1' : '0');
            updateDarkToggle(isDark);
        }
        function updateDarkToggle(isDark) {
            var label = document.getElementById('darkLabel');
            var icon = document.getElementById('darkIcon');
            while (icon.firstChild) icon.removeChild(icon.firstChild);
            var svgNS = 'http://www.w3.org/2000/svg';
            if (isDark) {
                label.textContent = 'Light Mode';
                var circle = document.createElementNS(svgNS, 'circle');
                circle.setAttribute('cx', '12'); circle.setAttribute('cy', '12'); circle.setAttribute('r', '5');
                icon.appendChild(circle);
                [[12,1,12,3],[12,21,12,23],[4.22,4.22,5.64,5.64],[18.36,18.36,19.78,19.78],[1,12,3,12],[21,12,23,12],[4.22,19.78,5.64,18.36],[18.36,5.64,19.78,4.22]].forEach(function(l) {
                    var ln = document.createElementNS(svgNS, 'line');
                    ln.setAttribute('x1', l[0]); ln.setAttribute('y1', l[1]);
                    ln.setAttribute('x2', l[2]); ln.setAttribute('y2', l[3]);
                    icon.appendChild(ln);
                });
            } else {
                label.textContent = 'Dark Mode';
                var path = document.createElementNS(svgNS, 'path');
                path.setAttribute('d', 'M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z');
                icon.appendChild(path);
            }
        }
        // Restore dark mode preference
        if (localStorage.getItem('darkMode') === '1') {
            document.body.classList.add('dark-mode');
            updateDarkToggle(true);
        }

        // Scroll-to-top button (created dynamically to ensure it exists)
        (function() {
            var btn = document.createElement('button');
            btn.className = 'scroll-to-top';
            btn.id = 'scrollTopBtn';
            btn.setAttribute('aria-label', 'Scroll to top');
            var svgNS = 'http://www.w3.org/2000/svg';
            var svg = document.createElementNS(svgNS, 'svg');
            svg.setAttribute('width', '20'); svg.setAttribute('height', '20');
            svg.setAttribute('viewBox', '0 0 24 24'); svg.setAttribute('fill', 'none');
            svg.setAttribute('stroke', 'currentColor'); svg.setAttribute('stroke-width', '2.5');
            svg.setAttribute('stroke-linecap', 'round'); svg.setAttribute('stroke-linejoin', 'round');
            var polyline = document.createElementNS(svgNS, 'polyline');
            polyline.setAttribute('points', '18 15 12 9 6 15');
            svg.appendChild(polyline);
            btn.appendChild(svg);
            document.body.appendChild(btn);

            window.addEventListener('scroll', function() {
                if (window.scrollY > 400) {
                    btn.classList.add('visible');
                } else {
                    btn.classList.remove('visible');
                }
            });
            btn.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        })();
    </script>
</body>
</html>
